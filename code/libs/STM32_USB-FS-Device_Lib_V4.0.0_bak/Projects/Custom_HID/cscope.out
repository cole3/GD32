cscope 15 $HOME/work/gd32/code/libs/STM32_USB-FS-Device_Lib_V4.0.0/Projects/Custom_HID -q 0000000799 0000070729
	@inc/hw_config.h

30 #ide
__HW_CONFIG_H


31 
	#__HW_CONFIG_H


	)

34 
	~"fm_cfig.h
"

35 
	~"usb_ty.h
"

42 
S_Syem
();

43 
S_USBClock
();

44 
E_LowPowMode
();

45 
Lve_LowPowMode
();

46 
USB_Irus_Cfig
();

47 
USB_Cab_Cfig
 (
FuniڮS
 
NewS
);

48 
GPIO_Cfiguti
();

49 
EXTI_Cfiguti
();

50 
ADC_Cfiguti
();

51 
ADC30x_Cfiguti
();

52 
G_SlNum
();

53 
TimgDay_Deemt
();

54 
Day
(
__IO
 
ut32_t
 
nCou
);

	@inc/platform_config.h

30 #ide
__PLATFORM_CONFIG_H


31 
	#__PLATFORM_CONFIG_H


	)

35 #i
defed
(
STM32L1XX_MD
|| defed(
STM32L1XX_HD
)|| defed(
STM32L1XX_MD_PLUS
)

36 
	~"m32l1xx.h
"

37 #i
defed
 (
USE_STM32L152_EVAL
)

38 
	~"m32l152_ev.h
"

39 #i
defed
 (
USE_STM32L152D_EVAL
)

40 
	~"m32l152d_ev.h
"

44 #i
defed
 (
STM32F10X_MD
|| defed (
STM32F10X_HD
|| defed (
STM32F10X_XL
)

45 
	~"m32f10x.h
"

46 #i
defed
 (
USE_STM3210B_EVAL
)

47 
	~"m3210b_ev.h
"

48 #i
defed
 (
USE_STM3210E_EVAL
)

49 
	~"m3210e_ev.h
"

53 #i
defed
 (
USE_STM32373C_EVAL
)

54 
	~"m32f37x.h
"

55 
	~"m32373c_ev.h
"

56 #i
defed
 (
USE_STM32303C_EVAL
)

57 
	~"m32f30x.h
"

58 
	~"m32303c_ev.h
"

65 #i!
defed
 (
USE_STM3210B_EVAL
&& !defed (
USE_STM3210E_EVAL
&& !defed (
USE_STM32L152_EVAL
&& !defed (
USE_STM32L152D_EVAL
)&& !defed (
USE_STM32373C_EVAL
&& !defed (
USE_STM32303C_EVAL
)

71 
	#USE_STM32303C_EVAL


	)

76 #i
defed
(
STM32L1XX_MD
|| defed(
STM32L1XX_HD
|| defed(
STM32L1XX_MD_PLUS
)

78 
	#ID1
 (0x1FF80050)

	)

79 
	#ID2
 (0x1FF80054)

	)

80 
	#ID3
 (0x1FF80064)

	)

82 #i
defed
 (
STM32F37X
|| defed(
STM32F30X
)

84 
	#ID1
 (0x1FFFF7AC)

	)

85 
	#ID2
 (0x1FFFF7B0)

	)

86 
	#ID3
 (0x1FFFF7B4)

	)

90 
	#ID1
 (0x1FFFF7E8)

	)

91 
	#ID2
 (0x1FFFF7EC)

	)

92 
	#ID3
 (0x1FFFF7F0)

	)

97 #ifde
USE_STM3210B_EVAL


98 
	#USB_DISCONNECT
 
GPIOD


	)

99 
	#USB_DISCONNECT_PIN
 
GPIO_P_9


	)

100 
	#RCC_APB2Ph_GPIO_DISCONNECT
 
RCC_APB2Ph_GPIOD


	)

101 
	#ADC1_DR_Addss
 ((
ut32_t
)0x4001244C)

	)

103 #i
defed
 (
USE_STM3210E_EVAL
)

104 
	#USB_DISCONNECT
 
GPIOB


	)

105 
	#USB_DISCONNECT_PIN
 
GPIO_P_14


	)

106 
	#RCC_APB2Ph_GPIO_DISCONNECT
 
RCC_APB2Ph_GPIOB


	)

107 
	#ADC1_DR_Addss
 ((
ut32_t
)0x4001244C)

	)

109 #i
defed
 (
USE_STM32L152_EVAL
|| defed (
USE_STM32L152D_EVAL
)

125 #i!
defed
(
USB_USE_EXTERNAL_PULLUP
)

126 
	#STM32L15_USB_CONNECT
 
	`SYSCFG_USBPuCmd
(
ENABLE
)

	)

127 
	#STM32L15_USB_DISCONNECT
 
	`SYSCFG_USBPuCmd
(
DISABLE
)

	)

128 
	#RCC_AHBPh_GPIO_DISCONNECT
 0

	)

130 #i
defed
(
USB_USE_EXTERNAL_PULLUP
)

133 
	#USB_DISCONNECT
 
GPIOA


	)

134 
	#USB_DISCONNECT_PIN
 
GPIO_P_0


	)

135 
	#RCC_AHBPh_GPIO_DISCONNECT
 
RCC_AHBPh_GPIOA


	)

136 
	#STM32L15_USB_CONNECT
 
	`GPIO_RetBs
(
USB_DISCONNECT
, 
USB_DISCONNECT_PIN
)

	)

137 
	#STM32L15_USB_DISCONNECT
 
	`GPIO_SBs
(
USB_DISCONNECT
, 
USB_DISCONNECT_PIN
)

	)

140 
	#ADC1_DR_Addss
 ((
ut32_t
)0x40012458)

	)

144 #i
defed
 (
USE_STM32373C_EVAL
)

145 
	#USB_DISCONNECT
 
GPIOC


	)

146 
	#USB_DISCONNECT_PIN
 
GPIO_P_5


	)

147 
	#RCC_AHBPh_GPIO_DISCONNECT
 
RCC_AHBPh_GPIOC


	)

149 #i
defed
 (
USE_STM32303C_EVAL
)

150 
	#USB_DISCONNECT
 
GPIOB


	)

151 
	#USB_DISCONNECT_PIN
 
GPIO_P_8


	)

152 
	#RCC_AHBPh_GPIO_DISCONNECT
 
RCC_AHBPh_GPIOB


	)

154 
	#RCC_AHBPh_ALLGPIO
 (
RCC_AHBPh_GPIOA
 \

	)

155 | 
	gRCC_AHBPh_GPIOB
 \

156 | 
	gRCC_AHBPh_GPIOC
 \

157 | 
	gRCC_AHBPh_GPIOD
 \

158 | 
	gRCC_AHBPh_GPIOE
 \

159 | 
	gRCC_AHBPh_GPIOF
 )

162 #i
defed
 (
USE_STM32L152_EVAL
)

164 
	#RCC_AHBPh_GPIO_IOAIN
 
RCC_AHBPh_GPIOB


	)

165 
	#GPIO_IOAIN
 
GPIOB


	)

166 
	#GPIO_IOAIN_PIN
 
GPIO_P_12


	)

167 
	#ADC_AIN_CHANNEL
 
ADC_Chl_18


	)

169 #i
defed
 (
USE_STM32L152D_EVAL
)

171 
	#RCC_AHBPh_GPIO_IOAIN
 
RCC_AHBPh_GPIOF


	)

172 
	#GPIO_IOAIN
 
GPIOF


	)

173 
	#GPIO_IOAIN_PIN
 
GPIO_P_10


	)

174 
	#ADC_AIN_CHANNEL
 
ADC_Chl_31


	)

176 #i
defed
 (
USE_STM32373C_EVAL
)

178 
	#ADC1_DR_Addss
 0x4001244C

	)

180 
	#RCC_AHBPh_GPIO_IOAIN
 
RCC_AHBPh_GPIOB


	)

181 
	#GPIO_IOAIN
 
GPIOB


	)

182 
	#GPIO_IOAIN_PIN
 
GPIO_P_1


	)

183 
	#ADC_AIN_CHANNEL
 
ADC_Chl_9


	)

184 
	#GPIO_Mode_AIN
 
GPIO_Mode_AN


	)

186 #i
defed
 (
USE_STM32303C_EVAL
)

188 
	#ADC1_DR_Addss
 0x5000030C

	)

190 
	#RCC_AHBPh_GPIO_IOAIN
 
RCC_AHBPh_GPIOC


	)

191 
	#GPIO_IOAIN
 
GPIOC


	)

192 
	#GPIO_IOAIN_PIN
 
GPIO_P_1


	)

193 
	#ADC_AIN_CHANNEL
 
ADC_Chl_7


	)

194 
	#GPIO_Mode_AIN
 
GPIO_Mode_AN


	)

197 
	#RCC_APB2Ph_GPIO_IOAIN
 
RCC_APB2Ph_GPIOC


	)

198 
	#GPIO_IOAIN
 
GPIOC


	)

199 
	#GPIO_IOAIN_PIN
 
GPIO_P_4


	)

200 
	#ADC_AIN_CHANNEL
 
ADC_Chl_14


	)

	@inc/stm32_it.h

30 #ide
__STM32_IT_H


31 
	#__STM32_IT_H


	)

34 
	~"fm_cfig.h
"

41 
NMI_Hdr
();

42 
HdFau_Hdr
();

43 
MemMage_Hdr
();

44 
BusFau_Hdr
();

45 
UgeFau_Hdr
();

46 
SVC_Hdr
();

47 
DebugM_Hdr
();

48 
PdSV_Hdr
();

49 
SysTick_Hdr
();

50 
USB_LP_CAN1_RX0_IRQHdr
();

51 
DMA1_Chl1_IRQHdr
();

52 
EXTI9_5_IRQHdr
();

53 
EXTI15_10_IRQHdr
();

	@inc/stm32f10x_conf.h

30 #ide
__STM32F10x_CONF_H


31 
	#__STM32F10x_CONF_H


	)

35 
	~"m32f10x_adc.h
"

36 
	~"m32f10x_bkp.h
"

37 
	~"m32f10x_n.h
"

38 
	~"m32f10x_c.h
"

39 
	~"m32f10x_dac.h
"

40 
	~"m32f10x_dbgmcu.h
"

41 
	~"m32f10x_dma.h
"

42 
	~"m32f10x_exti.h
"

43 
	~"m32f10x_ash.h
"

44 
	~"m32f10x_fsmc.h
"

45 
	~"m32f10x_gpio.h
"

46 
	~"m32f10x_i2c.h
"

47 
	~"m32f10x_iwdg.h
"

48 
	~"m32f10x_pwr.h
"

49 
	~"m32f10x_rcc.h
"

50 
	~"m32f10x_c.h
"

51 
	~"m32f10x_sdio.h
"

52 
	~"m32f10x_i.h
"

53 
	~"m32f10x_tim.h
"

54 
	~"m32f10x_u.h
"

55 
	~"m32f10x_wwdg.h
"

56 
	~"misc.h
"

65 #ifde 
USE_FULL_ASSERT


76 
	#as_m
(
ex
(x? ()0 : 
	`as_ed
((
ut8_t
 *)
__FILE__
, 
__LINE__
))

	)

78 
as_ed
(
ut8_t
* 
fe
, 
ut32_t
 
le
);

80 
	#as_m
(
ex
(()0)

	)

	@inc/stm32f30x_conf.h

29 #ide
__STM32F30X_CONF_H


30 
	#__STM32F30X_CONF_H


	)

34 
	~"m32f30x_adc.h
"

35 
	~"m32f30x_n.h
"

36 
	~"m32f30x_c.h
"

37 
	~"m32f30x_comp.h
"

38 
	~"m32f30x_dac.h
"

39 
	~"m32f30x_dbgmcu.h
"

40 
	~"m32f30x_dma.h
"

41 
	~"m32f30x_exti.h
"

42 
	~"m32f30x_ash.h
"

43 
	~"m32f30x_gpio.h
"

44 
	~"m32f30x_syscfg.h
"

45 
	~"m32f30x_i2c.h
"

46 
	~"m32f30x_iwdg.h
"

47 
	~"m32f30x_amp.h
"

48 
	~"m32f30x_pwr.h
"

49 
	~"m32f30x_rcc.h
"

50 
	~"m32f30x_c.h
"

51 
	~"m32f30x_i.h
"

52 
	~"m32f30x_tim.h
"

53 
	~"m32f30x_u.h
"

54 
	~"m32f30x_wwdg.h
"

55 
	~"m32f30x_misc.h
"

64 #ifde 
USE_FULL_ASSERT


73 
	#as_m
(
ex
(x? ()0 : 
	`as_ed
((
ut8_t
 *)
__FILE__
, 
__LINE__
))

	)

75 
as_ed
(
ut8_t
* 
fe
, 
ut32_t
 
le
);

77 
	#as_m
(
ex
(()0)

	)

	@inc/stm32f37x_conf.h

29 #ide
__STM32F37X_CONF_H


30 
	#__STM32F37X_CONF_H


	)

34 
	~"m32f37x_adc.h
"

35 
	~"m32f37x_n.h
"

36 
	~"m32f37x_c.h
"

37 
	~"m32f37x_c.h
"

38 
	~"m32f37x_comp.h
"

39 
	~"m32f37x_dac.h
"

40 
	~"m32f37x_dbgmcu.h
"

41 
	~"m32f37x_dma.h
"

42 
	~"m32f37x_exti.h
"

43 
	~"m32f37x_ash.h
"

44 
	~"m32f37x_gpio.h
"

45 
	~"m32f37x_syscfg.h
"

46 
	~"m32f37x_i2c.h
"

47 
	~"m32f37x_iwdg.h
"

48 
	~"m32f37x_pwr.h
"

49 
	~"m32f37x_rcc.h
"

50 
	~"m32f37x_c.h
"

51 
	~"m32f37x_sdadc.h
"

52 
	~"m32f37x_i.h
"

53 
	~"m32f37x_tim.h
"

54 
	~"m32f37x_u.h
"

55 
	~"m32f37x_wwdg.h
"

56 
	~"m32f37x_misc.h
"

65 #ifde 
USE_FULL_ASSERT


74 
	#as_m
(
ex
(x? ()0 : 
	`as_ed
((
ut8_t
 *)
__FILE__
, 
__LINE__
))

	)

76 
as_ed
(
ut8_t
* 
fe
, 
ut32_t
 
le
);

78 
	#as_m
(
ex
(()0)

	)

	@inc/stm32l1xx_conf.h

29 #ide
__STM32L1xx_CONF_H


30 
	#__STM32L1xx_CONF_H


	)

34 
	~"m32l1xx_adc.h
"

35 
	~"m32l1xx_c.h
"

36 
	~"m32l1xx_comp.h
"

37 
	~"m32l1xx_dac.h
"

38 
	~"m32l1xx_dbgmcu.h
"

39 
	~"m32l1xx_dma.h
"

40 
	~"m32l1xx_exti.h
"

41 
	~"m32l1xx_ash.h
"

42 
	~"m32l1xx_gpio.h
"

43 
	~"m32l1xx_syscfg.h
"

44 
	~"m32l1xx_i2c.h
"

45 
	~"m32l1xx_iwdg.h
"

46 
	~"m32l1xx_lcd.h
"

47 
	~"m32l1xx_pwr.h
"

48 
	~"m32l1xx_rcc.h
"

49 
	~"m32l1xx_c.h
"

50 
	~"m32l1xx_i.h
"

51 
	~"m32l1xx_tim.h
"

52 
	~"m32l1xx_u.h
"

53 
	~"m32l1xx_wwdg.h
"

54 
	~"misc.h
"

63 #ifde 
USE_FULL_ASSERT


73 
	#as_m
(
ex
(x? ()0 : 
	`as_ed
((
ut8_t
 *)
__FILE__
, 
__LINE__
))

	)

75 
as_ed
(
ut8_t
* 
fe
, 
ut32_t
 
le
);

77 
	#as_m
(
ex
(()0)

	)

	@inc/usb_conf.h

30 #ide
__USB_CONF_H


31 
	#__USB_CONF_H


	)

43 
	#EP_NUM
 (2)

	)

50 
	#BTABLE_ADDRESS
 (0x00)

	)

54 
	#ENDP0_RXADDR
 (0x18)

	)

55 
	#ENDP0_TXADDR
 (0x58)

	)

59 
	#ENDP1_TXADDR
 (0x100)

	)

60 
	#ENDP1_RXADDR
 (0x104)

	)

69 
	#IMR_MSK
 (
CNTR_CTRM
 | 
CNTR_WKUPM
 | 
CNTR_SUSPM
 | 
CNTR_ERRM
 | 
CNTR_SOFM
 \

	)

70 | 
	gCNTR_ESOFM
 | 
	gCNTR_RESETM
 )

75 
	#EP2_IN_Clback
 
NOP_Pross


	)

76 
	#EP3_IN_Clback
 
NOP_Pross


	)

77 
	#EP4_IN_Clback
 
NOP_Pross


	)

78 
	#EP5_IN_Clback
 
NOP_Pross


	)

79 
	#EP6_IN_Clback
 
NOP_Pross


	)

80 
	#EP7_IN_Clback
 
NOP_Pross


	)

83 
	#EP2_OUT_Clback
 
NOP_Pross


	)

84 
	#EP3_OUT_Clback
 
NOP_Pross


	)

85 
	#EP4_OUT_Clback
 
NOP_Pross


	)

86 
	#EP5_OUT_Clback
 
NOP_Pross


	)

87 
	#EP6_OUT_Clback
 
NOP_Pross


	)

88 
	#EP7_OUT_Clback
 
NOP_Pross


	)

	@inc/usb_desc.h

30 #ide
__USB_DESC_H


31 
	#__USB_DESC_H


	)

38 
	#USB_DEVICE_DESCRIPTOR_TYPE
 0x01

	)

39 
	#USB_CONFIGURATION_DESCRIPTOR_TYPE
 0x02

	)

40 
	#USB_STRING_DESCRIPTOR_TYPE
 0x03

	)

41 
	#USB_INTERFACE_DESCRIPTOR_TYPE
 0x04

	)

42 
	#USB_ENDPOINT_DESCRIPTOR_TYPE
 0x05

	)

44 
	#HID_DESCRIPTOR_TYPE
 0x21

	)

45 
	#CUSTOMHID_SIZ_HID_DESC
 0x09

	)

46 
	#CUSTOMHID_OFF_HID_DESC
 0x12

	)

48 
	#CUSTOMHID_SIZ_DEVICE_DESC
 18

	)

49 
	#CUSTOMHID_SIZ_CONFIG_DESC
 41

	)

50 
	#CUSTOMHID_SIZ_REPORT_DESC
 163

	)

51 
	#CUSTOMHID_SIZ_STRING_LANGID
 4

	)

52 
	#CUSTOMHID_SIZ_STRING_VENDOR
 38

	)

53 
	#CUSTOMHID_SIZ_STRING_PRODUCT
 32

	)

54 
	#CUSTOMHID_SIZ_STRING_SERIAL
 26

	)

56 
	#STANDARD_ENDPOINT_DESC_SIZE
 0x09

	)

59 cڡ 
ut8_t
 
CuomHID_DeviDest
[
CUSTOMHID_SIZ_DEVICE_DESC
];

60 cڡ 
ut8_t
 
CuomHID_CfigDest
[
CUSTOMHID_SIZ_CONFIG_DESC
];

61 cڡ 
ut8_t
 
CuomHID_RtDest
[
CUSTOMHID_SIZ_REPORT_DESC
];

62 cڡ 
ut8_t
 
CuomHID_SgLgID
[
CUSTOMHID_SIZ_STRING_LANGID
];

63 cڡ 
ut8_t
 
CuomHID_SgVd
[
CUSTOMHID_SIZ_STRING_VENDOR
];

64 cڡ 
ut8_t
 
CuomHID_SgProdu
[
CUSTOMHID_SIZ_STRING_PRODUCT
];

65 
ut8_t
 
CuomHID_SgSl
[
CUSTOMHID_SIZ_STRING_SERIAL
];

	@inc/usb_istr.h

29 #ide
__USB_ISTR_H


30 
	#__USB_ISTR_H


	)

33 
	~"usb_cf.h
"

40 
USB_Ir
();

44 
EP1_IN_Clback
();

45 
EP2_IN_Clback
();

46 
EP3_IN_Clback
();

47 
EP4_IN_Clback
();

48 
EP5_IN_Clback
();

49 
EP6_IN_Clback
();

50 
EP7_IN_Clback
();

52 
EP1_OUT_Clback
();

53 
EP2_OUT_Clback
();

54 
EP3_OUT_Clback
();

55 
EP4_OUT_Clback
();

56 
EP5_OUT_Clback
();

57 
EP6_OUT_Clback
();

58 
EP7_OUT_Clback
();

61 #ifde
CTR_CALLBACK


62 
CTR_Clback
();

65 #ifde
DOVR_CALLBACK


66 
DOVR_Clback
();

69 #ifde
ERR_CALLBACK


70 
ERR_Clback
();

73 #ifde
WKUP_CALLBACK


74 
WKUP_Clback
();

77 #ifde
SUSP_CALLBACK


78 
SUSP_Clback
();

81 #ifde
RESET_CALLBACK


82 
RESET_Clback
();

85 #ifde
SOF_CALLBACK


86 
SOF_Clback
();

89 #ifde
ESOF_CALLBACK


90 
ESOF_Clback
();

	@inc/usb_prop.h

30 #ide
__USB_PROP_H


31 
	#__USB_PROP_H


	)

35 
	e_HID_REQUESTS


37 
	mGET_REPORT
 = 1,

38 
	mGET_IDLE
,

39 
	mGET_PROTOCOL
,

41 
	mSET_REPORT
 = 9,

42 
	mSET_IDLE
,

43 
	mSET_PROTOCOL


44 } 
	tHID_REQUESTS
;

49 
CuomHID_
();

50 
CuomHID_Ret
();

51 
CuomHID_SCfiguti
();

52 
CuomHID_SDeviAddss
 ();

53 
CuomHID_Stus_In
 ();

54 
CuomHID_Stus_Out
 ();

55 
RESULT
 
CuomHID_Da_Sup
(
ut8_t
);

56 
RESULT
 
CuomHID_NoDa_Sup
(
ut8_t
);

57 
RESULT
 
CuomHID_G_I_Stg
(
ut8_t
 
I
, ut8_
AɔǋStg
);

58 
ut8_t
 *
CuomHID_GDeviDest
(
ut16_t
 );

59 
ut8_t
 *
CuomHID_GCfigDest
(
ut16_t
);

60 
ut8_t
 *
CuomHID_GSgDest
(
ut16_t
);

61 
RESULT
 
CuomHID_SProc
();

62 
ut8_t
 *
CuomHID_GProcVue
(
ut16_t
 
Lgth
);

63 
RESULT
 
CuomHID_SProc
();

64 
ut8_t
 *
CuomHID_GRtDest
(
ut16_t
 
Lgth
);

65 
ut8_t
 *
CuomHID_GHIDDest
(
ut16_t
 
Lgth
);

69 
	#CuomHID_GCfiguti
 
NOP_Pross


	)

71 
	#CuomHID_GI
 
NOP_Pross


	)

72 
	#CuomHID_SI
 
NOP_Pross


	)

73 
	#CuomHID_GStus
 
NOP_Pross


	)

74 
	#CuomHID_CˬFtu
 
NOP_Pross


	)

75 
	#CuomHID_SEndPotFtu
 
NOP_Pross


	)

76 
	#CuomHID_SDeviFtu
 
NOP_Pross


	)

79 
	#REPORT_DESCRIPTOR
 0x22

	)

	@inc/usb_pwr.h

29 #ide
__USB_PWR_H


30 
	#__USB_PWR_H


	)

34 
	e_RESUME_STATE


36 
	mRESUME_EXTERNAL
,

37 
	mRESUME_INTERNAL
,

38 
	mRESUME_LATER
,

39 
	mRESUME_WAIT
,

40 
	mRESUME_START
,

41 
	mRESUME_ON
,

42 
	mRESUME_OFF
,

43 
	mRESUME_ESOF


44 } 
	tRESUME_STATE
;

46 
	e_DEVICE_STATE


48 
	mUNCONNECTED
,

49 
	mATTACHED
,

50 
	mPOWERED
,

51 
	mSUSPENDED
,

52 
	mADDRESSED
,

53 
	mCONFIGURED


54 } 
	tDEVICE_STATE
;

59 
Sud
();

60 
Resume_In
();

61 
Resume
(
RESUME_STATE
 
eResumeSV
);

62 
RESULT
 
PowOn
();

63 
RESULT
 
PowOff
();

65 
__IO
 
ut32_t
 
bDeviS
;

66 
__IO
 
bo
 
fSudEbd
;

	@src/hw_config.c

30 
	~"hw_cfig.h
"

31 
	~"usb_lib.h
"

32 
	~"usb_desc.h
"

33 
	~"usb_pwr.h
"

40 
EStus
 
	gHSESUpStus
;

41 
ut32_t
 
	gADC_CvdVueX
 = 0;

42 
ut32_t
 
	gADC_CvdVueX_1
 = 0;

43 
__IO
 
ut16_t
 
	gADC1CvdVue
 = 0, 
	gADC1CvdVޏge
 = 0, 
	glibti_vue
 = 0;

47 
IToUnicode
 (
ut32_t
 
vue
 , 
ut8_t
 *
pbuf
 , ut8_
n
);

56 
	$S_Syem
()

58 #i
	`defed
 (
STM32F37X
|| defed (
STM32F30X
)

59 
GPIO_InTyDef
 
GPIO_InSuu
;

62 #i
	`defed
(
USB_USE_EXTERNAL_PULLUP
)

63 
GPIO_InTyDef
 
GPIO_InSuu
;

73 #i
	`defed
(
STM32L1XX_MD
|| defed(
STM32L1XX_HD
)|| defed(
STM32L1XX_MD_PLUS
|| defed (
STM32F37X
|| defed (
STM32F30X
)

75 
	`RCC_APB2PhClockCmd
(
RCC_APB2Ph_SYSCFG
, 
ENABLE
);

79 #i!
	`defed
(
STM32L1XX_MD
&& !defed(
STM32L1XX_HD
&& !defed(
STM32L1XX_MD_PLUS
&& !defed(
STM32F37X
&& !defed(
STM32F30X
)

81 
	`RCC_APB2PhClockCmd
(
RCC_APB2Ph_GPIO_DISCONNECT
, 
ENABLE
);

84 
	`RCC_ADCCLKCfig
(
RCC_PCLK2_Div8
);

88 
	`GPIO_Cfiguti
();

90 #i
	`defed
(
USB_USE_EXTERNAL_PULLUP
)

92 
	`RCC_AHBPhClockCmd
(
RCC_AHBPh_GPIO_DISCONNECT
, 
ENABLE
);

95 
GPIO_InSuu
.
GPIO_P
 = 
USB_DISCONNECT_PIN
;

96 
GPIO_InSuu
.
GPIO_Mode
 = 
GPIO_Mode_OUT
;

97 
GPIO_InSuu
.
GPIO_Sed
 = 
GPIO_Sed_2MHz
;

98 
GPIO_InSuu
.
GPIO_OTy
 = 
GPIO_OTy_PP
;

99 
GPIO_InSuu
.
GPIO_PuPd
 = 
GPIO_PuPd_NOPULL
;

100 
	`GPIO_In
(
USB_DISCONNECT
, &
GPIO_InSuu
);

103 #i
	`defed
(
STM32F37X
|| defed(
STM32F30X
)

106 
	`RCC_AHBPhClockCmd
(
RCC_AHBPh_GPIO_DISCONNECT
, 
ENABLE
);

109 
	`RCC_AHBPhClockCmd
(
RCC_AHBPh_GPIOA
, 
ENABLE
);

110 
GPIO_InSuu
.
GPIO_P
 = 
GPIO_P_11
 | 
GPIO_P_12
;

111 
GPIO_InSuu
.
GPIO_Sed
 = 
GPIO_Sed_50MHz
;

112 
GPIO_InSuu
.
GPIO_Mode
 = 
GPIO_Mode_AF
;

113 
GPIO_InSuu
.
GPIO_OTy
 = 
GPIO_OTy_PP
;

114 
GPIO_InSuu
.
GPIO_PuPd
 = 
GPIO_PuPd_NOPULL
;

115 
	`GPIO_In
(
GPIOA
, &
GPIO_InSuu
);

118 
	`GPIO_PAFCfig
(
GPIOA
, 
GPIO_PSour11
, 
GPIO_AF_14
);

119 
	`GPIO_PAFCfig
(
GPIOA
, 
GPIO_PSour12
, 
GPIO_AF_14
);

122 
GPIO_InSuu
.
GPIO_P
 = 
USB_DISCONNECT_PIN
;

123 
GPIO_InSuu
.
GPIO_Sed
 = 
GPIO_Sed_2MHz
;

124 
GPIO_InSuu
.
GPIO_Mode
 = 
GPIO_Mode_OUT
;

125 
GPIO_InSuu
.
GPIO_OTy
 = 
GPIO_OTy_OD
;

126 
GPIO_InSuu
.
GPIO_PuPd
 = 
GPIO_PuPd_NOPULL
;

127 
	`GPIO_In
(
USB_DISCONNECT
, &
GPIO_InSuu
);

130 #i
	`defed
(
STM32L1XX_MD
)

132 
	`STM_EVAL_PBIn
(
Bu_LEFT
, 
Mode_EXTI
);

135 
	`STM_EVAL_PBIn
(
Bu_RIGHT
, 
Mode_EXTI
);

138 
	`STM_EVAL_PBIn
(
Bu_KEY
, 
Mode_EXTI
);

139 #i!
	`defed
(
STM32L1XX_HD
)&& !defed(
STM32L1XX_MD_PLUS
&& !defed(
STM32F37X
&& !defed(
STM32F30X
)

141 
	`STM_EVAL_PBIn
(
Bu_TAMPER
, 
Mode_EXTI
);

145 
	`EXTI_Cfiguti
();

148 
	`STM_EVAL_LEDIn
(
LED1
);

149 
	`STM_EVAL_LEDIn
(
LED2
);

150 
	`STM_EVAL_LEDIn
(
LED3
);

151 
	`STM_EVAL_LEDIn
(
LED4
);

153 #i
	`defed
 (
STM32F30X
)

154 
	`ADC30x_Cfiguti
();

157 
	`ADC_Cfiguti
();

160 
	}
}

169 
	$S_USBClock
()

171 #i
	`defed
(
STM32L1XX_MD
|| defed(
STM32L1XX_HD
)|| defed(
STM32L1XX_MD_PLUS
)

173 
	`RCC_APB1PhClockCmd
(
RCC_APB1Ph_USB
, 
ENABLE
);

177 
	`RCC_USBCLKCfig
(
RCC_USBCLKSour_PLLCLK_1Div5
);

180 
	`RCC_APB1PhClockCmd
(
RCC_APB1Ph_USB
, 
ENABLE
);

182 
	}
}

191 
	$E_LowPowMode
()

194 
bDeviS
 = 
SUSPENDED
;

195 
	}
}

204 
	$Lve_LowPowMode
()

206 
DEVICE_INFO
 *
pInfo
 = &
Devi_Info
;

209 i(
pInfo
->
Cut_Cfiguti
 != 0)

212 
bDeviS
 = 
CONFIGURED
;

216 
bDeviS
 = 
ATTACHED
;

219 
	`SyemIn
();

220 #i
	`defed
(
STM32L1XX_MD
|| defed(
STM32L1XX_HD
)|| defed(
STM32L1XX_MD_PLUS
)

222 
	`RCC_HSICmd
(
ENABLE
);

224 #i
	`defed
(
STM32F30X
)

225 
	`ADC30x_Cfiguti
();

227 
	}
}

236 
	$USB_Irus_Cfig
()

238 
NVIC_InTyDef
 
NVIC_InSuu
;

241 
	`NVIC_PriܙyGroupCfig
(
NVIC_PriܙyGroup_2
);

243 #i
	`defed
(
STM32L1XX_MD
|| defed(
STM32L1XX_HD
)|| defed(
STM32L1XX_MD_PLUS
)

244 
NVIC_InSuu
.
NVIC_IRQChl
 = 
USB_LP_IRQn
;

245 
NVIC_InSuu
.
NVIC_IRQChlPemiPriܙy
 = 1;

246 
NVIC_InSuu
.
NVIC_IRQChlSubPriܙy
 = 0;

247 
NVIC_InSuu
.
NVIC_IRQChlCmd
 = 
ENABLE
;

248 
	`NVIC_In
(&
NVIC_InSuu
);

251 
NVIC_InSuu
.
NVIC_IRQChl
 = 
USB_FS_WKUP_IRQn
;

252 
NVIC_InSuu
.
NVIC_IRQChlPemiPriܙy
 = 0;

253 
NVIC_InSuu
.
NVIC_IRQChlCmd
 = 
ENABLE
;

254 
	`NVIC_In
(&
NVIC_InSuu
);

256 #i
	`defed
(
STM32F37X
)

258 
NVIC_InSuu
.
NVIC_IRQChl
 = 
USB_LP_IRQn
;

259 
NVIC_InSuu
.
NVIC_IRQChlPemiPriܙy
 = 1;

260 
NVIC_InSuu
.
NVIC_IRQChlSubPriܙy
 = 0;

261 
NVIC_InSuu
.
NVIC_IRQChlCmd
 = 
ENABLE
;

262 
	`NVIC_In
(&
NVIC_InSuu
);

265 
NVIC_InSuu
.
NVIC_IRQChl
 = 
USBWakeUp_IRQn
;

266 
NVIC_InSuu
.
NVIC_IRQChlPemiPriܙy
 = 0;

267 
NVIC_InSuu
.
NVIC_IRQChlCmd
 = 
ENABLE
;

268 
	`NVIC_In
(&
NVIC_InSuu
);

272 
NVIC_InSuu
.
NVIC_IRQChl
 = 
USB_LP_CAN1_RX0_IRQn
;

273 
NVIC_InSuu
.
NVIC_IRQChlPemiPriܙy
 = 1;

274 
NVIC_InSuu
.
NVIC_IRQChlSubPriܙy
 = 0;

275 
NVIC_InSuu
.
NVIC_IRQChlCmd
 = 
ENABLE
;

276 
	`NVIC_In
(&
NVIC_InSuu
);

279 
NVIC_InSuu
.
NVIC_IRQChl
 = 
USBWakeUp_IRQn
;

280 
NVIC_InSuu
.
NVIC_IRQChlPemiPriܙy
 = 0;

281 
NVIC_InSuu
.
NVIC_IRQChlCmd
 = 
ENABLE
;

282 
	`NVIC_In
(&
NVIC_InSuu
);

286 
NVIC_InSuu
.
NVIC_IRQChl
 = 
EXTI9_5_IRQn
;

287 
NVIC_InSuu
.
NVIC_IRQChlPemiPriܙy
 = 0;

288 
	`NVIC_In
(&
NVIC_InSuu
);

291 
NVIC_InSuu
.
NVIC_IRQChl
 = 
EXTI15_10_IRQn
;

292 
NVIC_InSuu
.
NVIC_IRQChlPemiPriܙy
 = 0;

293 
	`NVIC_In
(&
NVIC_InSuu
);

296 
NVIC_InSuu
.
NVIC_IRQChl
 = 
DMA1_Chl1_IRQn
;

297 
NVIC_InSuu
.
NVIC_IRQChlPemiPriܙy
 = 2;

298 
	`NVIC_In
(&
NVIC_InSuu
);

300 
	}
}

309 
	$USB_Cab_Cfig
 (
FuniڮS
 
NewS
)

311 #i
	`defed
(
STM32L1XX_MD
|| defed (
STM32L1XX_HD
)|| (
STM32L1XX_MD_PLUS
)

312 i(
NewS
 !
DISABLE
)

314 
STM32L15_USB_CONNECT
;

318 
STM32L15_USB_DISCONNECT
;

322 i(
NewS
 !
DISABLE
)

324 
	`GPIO_RetBs
(
USB_DISCONNECT
, 
USB_DISCONNECT_PIN
);

328 
	`GPIO_SBs
(
USB_DISCONNECT
, 
USB_DISCONNECT_PIN
);

331 
	}
}

340 
	$GPIO_Cfiguti
()

342 
GPIO_InTyDef
 
GPIO_InSuu
;

344 #i
	`defed
(
STM32L1XX_MD
|| defed(
STM32L1XX_HD
)|| defed(
STM32L1XX_MD_PLUS
|| defed (
STM32F37X
|| defed (
STM32F30X
)

345 
	`RCC_AHBPhClockCmd
(
RCC_AHBPh_GPIO_DISCONNECT
 |

346 
RCC_AHBPh_GPIO_IOAIN
 , 
ENABLE
);

348 
	`RCC_APB2PhClockCmd
(
RCC_APB2Ph_GPIO_DISCONNECT
 |

349 
RCC_APB2Ph_GPIO_IOAIN
 , 
ENABLE
);

352 
GPIO_InSuu
.
GPIO_P
 = 
USB_DISCONNECT_PIN
;

353 
GPIO_InSuu
.
GPIO_Sed
 = 
GPIO_Sed_50MHz
;

354 
GPIO_InSuu
.
GPIO_Mode
 = 
GPIO_Mode_Out_OD
;

355 
	`GPIO_In
(
USB_DISCONNECT
, &
GPIO_InSuu
);

359 
GPIO_InSuu
.
GPIO_P
 = 
GPIO_IOAIN_PIN
;

360 
GPIO_InSuu
.
GPIO_Mode
 = 
GPIO_Mode_AIN
;

361 
	`GPIO_In
(
GPIO_IOAIN
, &
GPIO_InSuu
);

362 
	}
}

371 
	$EXTI_Cfiguti
()

373 
EXTI_InTyDef
 
EXTI_InSuu
;

375 #i
	`defed
 (
USE_STM32L152_EVAL
)

377 
EXTI_InSuu
.
EXTI_Le
 = 
RIGHT_BUTTON_EXTI_LINE
;

378 
EXTI_InSuu
.
EXTI_Mode
 = 
EXTI_Mode_Iru
;

379 
EXTI_InSuu
.
EXTI_Trigg
 = 
EXTI_Trigg_Risg_Flg
;

380 
EXTI_InSuu
.
EXTI_LeCmd
 = 
ENABLE
;

381 
	`EXTI_In
(&
EXTI_InSuu
);

384 
	`EXTI_CˬITPdgB
(
RIGHT_BUTTON_EXTI_LINE
);

387 
EXTI_InSuu
.
EXTI_Le
 = 
LEFT_BUTTON_EXTI_LINE
;

388 
	`EXTI_In
(&
EXTI_InSuu
);

391 
	`EXTI_CˬITPdgB
(
LEFT_BUTTON_EXTI_LINE
);

395 
EXTI_InSuu
.
EXTI_Le
 = 
KEY_BUTTON_EXTI_LINE
;

396 
EXTI_InSuu
.
EXTI_Mode
 = 
EXTI_Mode_Iru
;

397 
EXTI_InSuu
.
EXTI_Trigg
 = 
EXTI_Trigg_Risg_Flg
;

398 
EXTI_InSuu
.
EXTI_LeCmd
 = 
ENABLE
;

399 
	`EXTI_In
(&
EXTI_InSuu
);

402 
	`EXTI_CˬITPdgB
(
KEY_BUTTON_EXTI_LINE
);

405 #i!
	`defed
 (
USE_STM32L152D_EVAL
&& !defed (
STM32F30X
)

406 
EXTI_InSuu
.
EXTI_Le
 = 
TAMPER_BUTTON_EXTI_LINE
;

407 
EXTI_InSuu
.
EXTI_Mode
 = 
EXTI_Mode_Iru
;

408 
EXTI_InSuu
.
EXTI_Trigg
 = 
EXTI_Trigg_Risg_Flg
;

409 
EXTI_InSuu
.
EXTI_LeCmd
 = 
ENABLE
;

410 
	`EXTI_In
(&
EXTI_InSuu
);

413 
	`EXTI_CˬITPdgB
(
TAMPER_BUTTON_EXTI_LINE
);

418 
	`EXTI_CˬITPdgB
(
EXTI_Le18
);

419 
EXTI_InSuu
.
EXTI_Le
 = 
EXTI_Le18
;

420 
EXTI_InSuu
.
EXTI_Trigg
 = 
EXTI_Trigg_Risg
;

421 
EXTI_InSuu
.
EXTI_LeCmd
 = 
ENABLE
;

422 
	`EXTI_In
(&
EXTI_InSuu
);

423 
	}
}

424 #i!
defed
 (
STM32F30X
)

432 
	$ADC_Cfiguti
()

434 
ADC_InTyDef
 
ADC_InSuu
;

435 
DMA_InTyDef
 
DMA_InSuu
;

437 
	`RCC_AHBPhClockCmd
(
RCC_AHBPh_DMA1
, 
ENABLE
);

440 
	`RCC_APB2PhClockCmd
(
RCC_APB2Ph_ADC1
, 
ENABLE
);

443 
	`DMA_DeIn
(
DMA1_Chl1
);

444 
DMA_InSuu
.
DMA_PhBaAddr
 = 
ADC1_DR_Addss
;

445 
DMA_InSuu
.
DMA_MemyBaAddr
 = (
ut32_t
)&
ADC_CvdVueX
;

446 
DMA_InSuu
.
DMA_DIR
 = 
DMA_DIR_PhSRC
;

447 
DMA_InSuu
.
DMA_BufrSize
 = 1;

448 
DMA_InSuu
.
DMA_PhInc
 = 
DMA_PhInc_Dib
;

449 
DMA_InSuu
.
DMA_MemyInc
 = 
DMA_MemyInc_Dib
;

450 
DMA_InSuu
.
DMA_PhDaSize
 = 
DMA_PhDaSize_HfWd
;

451 
DMA_InSuu
.
DMA_MemyDaSize
 = 
DMA_MemyDaSize_HfWd
;

452 
DMA_InSuu
.
DMA_Mode
 = 
DMA_Mode_Ccur
;

453 
DMA_InSuu
.
DMA_Priܙy
 = 
DMA_Priܙy_High
;

454 
DMA_InSuu
.
DMA_M2M
 = 
DMA_M2M_Dib
;

455 
	`DMA_In
(
DMA1_Chl1
, &
DMA_InSuu
);

458 
	`DMA_Cmd
(
DMA1_Chl1
, 
ENABLE
);

461 
	`DMA_ITCfig
(
DMA1_Chl1
, 
DMA_IT_TC
, 
ENABLE
);

463 #i
	`defed
(
STM32L1XX_MD
|| defed(
STM32L1XX_HD
)|| defed(
STM32L1XX_MD_PLUS
)

465 
	`RCC_HSICmd
(
ENABLE
);

468 
	`ADC_SuIn
(&
ADC_InSuu
);

469 
ADC_InSuu
.
ADC_SnCvMode
 = 
ENABLE
;

470 
ADC_InSuu
.
ADC_CtuousCvMode
 = 
ENABLE
;

471 
ADC_InSuu
.
ADC_DaAlign
 = 
ADC_DaAlign_Right
;

472 
ADC_InSuu
.
ADC_NbrOfCvsi
 = 1;

473 
	`ADC_In
(
ADC1
, &
ADC_InSuu
);

475 #i
	`defed
 (
USE_STM32L152D_EVAL
)

477 
	`ADC_RegurChlCfig
(
ADC1
, 
ADC_Chl_31
, 1, 
ADC_SameTime_384Cyes
);

481 
	`ADC_RegurChlCfig
(
ADC1
, 
ADC_Chl_18
, 1, 
ADC_SameTime_384Cyes
);

484 #i!
	`defed
 (
USE_STM32373C_EVAL
)

486 
	`ADC_DMARequeALaTnsrCmd
(
ADC1
, 
ENABLE
);

489 
	`ADC_DMACmd
(
ADC1
, 
ENABLE
);

492 
	`ADC_Cmd
(
ADC1
, 
ENABLE
);

496 #i!
	`defed
 (
USE_STM32373C_EVAL
)

497 
ADC_InSuu
.
ADC_Mode
 = 
ADC_Mode_Inddt
;

500 
ADC_InSuu
.
ADC_SnCvMode
 = 
ENABLE
;

501 
ADC_InSuu
.
ADC_CtuousCvMode
 = 
ENABLE
;

502 
ADC_InSuu
.
ADC_ExTrigCv
 = 
ADC_ExTrigCv_Ne
;

503 
ADC_InSuu
.
ADC_DaAlign
 = 
ADC_DaAlign_Right
;

504 
ADC_InSuu
.
ADC_NbrOfChl
 = 1;

505 
	`ADC_In
(
ADC1
, &
ADC_InSuu
);

508 
	`ADC_RegurChlCfig
(
ADC1
, 
ADC_AIN_CHANNEL
, 1, 
ADC_SameTime_55Cyes5
);

511 
	`ADC_DMACmd
(
ADC1
, 
ENABLE
);

514 
	`ADC_Cmd
(
ADC1
, 
ENABLE
);

517 
	`ADC_RetCibti
(
ADC1
);

519 
	`ADC_GRetCibtiStus
(
ADC1
));

521 
	`ADC_SCibti
(
ADC1
);

524 
	`ADC_GCibtiStus
(
ADC1
));

527 
	}
}

536 
	$G_SlNum
()

538 
ut32_t
 
Devi_Sl0
, 
Devi_Sl1
, 
Devi_Sl2
;

540 
Devi_Sl0
 = *(
ut32_t
*)
ID1
;

541 
Devi_Sl1
 = *(
ut32_t
*)
ID2
;

542 
Devi_Sl2
 = *(
ut32_t
*)
ID3
;

544 
Devi_Sl0
 +
Devi_Sl2
;

546 i(
Devi_Sl0
 != 0)

548 
	`IToUnicode
 (
Devi_Sl0
, &
CuomHID_SgSl
[2] , 8);

549 
	`IToUnicode
 (
Devi_Sl1
, &
CuomHID_SgSl
[18], 4);

551 
	}
}

560 
	$IToUnicode
 (
ut32_t
 
vue
 , 
ut8_t
 *
pbuf
 , ut8_
n
)

562 
ut8_t
 
idx
 = 0;

564  
idx
 = 0 ; idx < 
n
 ; idx ++)

566 if((
vue
 >> 28)) < 0xA )

568 
pbuf
[ 2* 
idx
] = (
vue
 >> 28) + '0';

572 
pbuf
[2* 
idx
] = (
vue
 >> 28) + 'A' - 10;

575 
vue
 = value << 4;

577 
pbuf
[ 2* 
idx
 + 1] = 0;

579 
	}
}

588 #i
defed
 (
STM32F30X
)

590 
	$ADC30x_Cfiguti
()

592 
ADC_InTyDef
 
ADC_InSuu
;

593 
ADC_CommInTyDef
 
ADC_CommInSuu
;

594 
DMA_InTyDef
 
DMA_InSuu
;

597 
	`RCC_AHBPhClockCmd
(
RCC_AHBPh_DMA1
, 
ENABLE
);

599 
	`DMA_DeIn
(
DMA1_Chl1
);

600 
DMA_InSuu
.
DMA_PhBaAddr
 = 
ADC1_DR_Addss
;

601 
DMA_InSuu
.
DMA_MemyBaAddr
 = (
ut32_t
)&
ADC_CvdVueX
;

602 
DMA_InSuu
.
DMA_DIR
 = 
DMA_DIR_PhSRC
;

603 
DMA_InSuu
.
DMA_BufrSize
 = 1;

604 
DMA_InSuu
.
DMA_PhInc
 = 
DMA_PhInc_Dib
;

605 
DMA_InSuu
.
DMA_MemyInc
 = 
DMA_MemyInc_Dib
;

606 
DMA_InSuu
.
DMA_PhDaSize
 = 
DMA_PhDaSize_Wd
;

607 
DMA_InSuu
.
DMA_MemyDaSize
 = 
DMA_MemyDaSize_Wd
;

608 
DMA_InSuu
.
DMA_Mode
 = 
DMA_Mode_Ccur
;

609 
DMA_InSuu
.
DMA_Priܙy
 = 
DMA_Priܙy_Medium
;

610 
DMA_InSuu
.
DMA_M2M
 = 
DMA_M2M_Dib
;

611 
	`DMA_In
(
DMA1_Chl1
, &
DMA_InSuu
);

614 
	`DMA_Cmd
(
DMA1_Chl1
, 
ENABLE
);

617 
	`DMA_ITCfig
(
DMA1_Chl1
, 
DMA_IT_TC
, 
ENABLE
);

620 
	`RCC_ADCCLKCfig
(
RCC_ADC12PLLCLK_Div2
);

623 
	`RCC_AHBPhClockCmd
(
RCC_AHBPh_ADC12
, 
ENABLE
);

624 
	`ADC_DeIn
(
ADC1
);

625 
	`ADC_SuIn
(&
ADC_InSuu
);

628 
	`ADC_VޏgeRegutCmd
(
ADC1
, 
ENABLE
);

629 
	`ADC_SeCibtiMode
(
ADC1
, 
ADC_CibtiMode_Sg
);

630 
	`ADC_SCibti
(
ADC1
);

632 
	`ADC_GCibtiStus
(
ADC1
!
RESET
 );

633 
libti_vue
 = 
	`ADC_GCibtiVue
(
ADC1
);

636 
ADC_CommInSuu
.
ADC_Mode
 = 
ADC_Mode_Inddt
;

637 
ADC_CommInSuu
.
ADC_Clock
 = 
ADC_Clock_AsynClkMode
;

638 
ADC_CommInSuu
.
ADC_DMAAcssMode
 = 
ADC_DMAAcssMode_Dibd
;

639 
ADC_CommInSuu
.
ADC_DMAMode
 = 
ADC_DMAMode_OSh
;

640 
ADC_CommInSuu
.
ADC_TwoSamgDay
 = 0;

641 
	`ADC_CommIn
(
ADC1
, &
ADC_CommInSuu
);

644 
	`ADC_DMACmd
(
ADC1
, 
ENABLE
);

645 
	`ADC_DMACfig
(
ADC1
, 
ADC_DMAMode_Ccur
);

647 
ADC_InSuu
.
ADC_CtuousCvMode
 = 
ADC_CtuousCvMode_Eb
;

648 
ADC_InSuu
.
ADC_Resuti
 = 
ADC_Resuti_12b
;

649 
ADC_InSuu
.
ADC_ExTrigCvEvt
 = 
ADC_ExTrigCvEvt_0
;

650 
ADC_InSuu
.
ADC_ExTrigEvtEdge
 = 
ADC_ExTrigEvtEdge_Ne
;

651 
ADC_InSuu
.
ADC_DaAlign
 = 
ADC_DaAlign_Right
;

652 
ADC_InSuu
.
ADC_OvrunMode
 = 
ADC_OvrunMode_Dib
;

653 
ADC_InSuu
.
ADC_AutoInjMode
 = 
ADC_AutoInjec_Dib
;

654 
ADC_InSuu
.
ADC_NbrOfRegChl
 = 1;

655 
	`ADC_In
(
ADC1
, &
ADC_InSuu
);

658 
	`ADC_RegurChlCfig
(
ADC1
, 
ADC_Chl_7
, 1, 
ADC_SameTime_7Cyes5
);

661 
	`ADC_Cmd
(
ADC1
, 
ENABLE
);

664 !
	`ADC_GFgStus
(
ADC1
, 
ADC_FLAG_RDY
));

667 
	`ADC_SCvsi
(
ADC1
);

670 
	`ADC_GFgStus
(
ADC1
, 
ADC_FLAG_EOC
=
RESET
);

673 
ADC_CvdVueX
 =
	`ADC_GCvsiVue
(
ADC1
);

674 
	}
}

	@src/main.c

30 
	~"hw_cfig.h
"

31 
	~"usb_lib.h
"

32 
	~"usb_pwr.h
"

39 
__IO
 
ut8_t
 
	gPvXrCome
 = 1;

40 
__IO
 
ut32_t
 
	gTimgDay
 = 0;

42 
Day
(
__IO
 
ut32_t
 
nCou
);

53 
	$ma
()

55 
	`S_Syem
();

57 
	`USB_Irus_Cfig
();

59 
	`S_USBClock
();

61 
	`USB_In
();

66 
	}
}

75 
	$Day
(
__IO
 
ut32_t
 
nCou
)

77 
TimgDay
 = 
nCou
;

78 ; 
nCou
!= 0;nCount--);

79 
	}
}

81 #ifde 
USE_FULL_ASSERT


91 
	$as_ed
(
ut8_t
* 
fe
, 
ut32_t
 
le
)

100 
	}
}

	@src/stm32_it.c

33 
	~"m32_.h
"

34 
	~"usb_ir.h
"

35 
	~"usb_lib.h
"

36 
	~"usb_pwr.h
"

37 
	~"hw_cfig.h
"

43 
__IO
 
ut8_t
 
	gSd_Bufr
[2];

44 
__IO
 
ut8_t
 
PvXrCome
;

45 
ut32_t
 
ADC_CvdVueX
;

46 
ut32_t
 
ADC_CvdVueX_1
;

47 
__IO
 
ut32_t
 
TimgDay
;

63 
	$NMI_Hdr
()

65 
	}
}

74 
	$HdFau_Hdr
()

80 
	}
}

89 
	$MemMage_Hdr
()

95 
	}
}

104 
	$BusFau_Hdr
()

110 
	}
}

119 
	$UgeFau_Hdr
()

125 
	}
}

134 
	$SVC_Hdr
()

136 
	}
}

145 
	$DebugM_Hdr
()

147 
	}
}

156 
	$PdSV_Hdr
()

158 
	}
}

167 
	$SysTick_Hdr
()

169 
TimgDay
--;

170 
	}
}

184 #i
defed
(
STM32L1XX_MD
|| defed(
STM32L1XX_HD
)|| defed(
STM32L1XX_MD_PLUS
|| defed (
STM32F37X
)

185 
	$USB_LP_IRQHdr
()

187 
	$USB_LP_CAN1_RX0_IRQHdr
()

190 
	`USB_Ir
();

191 
	}
}

193 #i
defed
(
STM32L1XX_MD
)

201 
	$EXTI15_10_IRQHdr
()

204 if(
	`EXTI_GITStus
(
RIGHT_BUTTON_EXTI_LINE
!
RESET
)

206 i((
PvXrCome
&& (
bDeviS
 =
CONFIGURED
))

208 
Sd_Bufr
[0] = 0x05;

210 i(
	`STM_EVAL_PBGS
(
Bu_RIGHT
=
B_RESET
)

212 
Sd_Bufr
[1] = 0x01;

216 
Sd_Bufr
[1] = 0x00;

220 
	`USB_SIL_Wre
(
EP1_IN
, (
ut8_t
*
Sd_Bufr
, 2);

222 
	`SEPTxVid
(
ENDP1
);

224 
PvXrCome
 = 0;

227 
	`EXTI_CˬITPdgB
(
RIGHT_BUTTON_EXTI_LINE
);

231 if(
	`EXTI_GITStus
(
LEFT_BUTTON_EXTI_LINE
!
RESET
)

233 i((
PvXrCome
&& (
bDeviS
 =
CONFIGURED
))

235 
Sd_Bufr
[0] = 0x06;

237 i(
	`STM_EVAL_PBGS
(
Bu_LEFT
=
B_RESET
)

239 
Sd_Bufr
[1] = 0x01;

243 
Sd_Bufr
[1] = 0x00;

247 
	`USB_SIL_Wre
(
EP1_IN
, (
ut8_t
*
Sd_Bufr
, 2);

249 
	`SEPTxVid
(
ENDP1
);

251 
PvXrCome
 = 0;

254 
	`EXTI_CˬITPdgB
(
LEFT_BUTTON_EXTI_LINE
);

256 
	}
}

265 
	$DMA1_Chl1_IRQHdr
()

267 
Sd_Bufr
[0] = 0x07;

269 if((
ADC_CvdVueX
 >>4- (
ADC_CvdVueX_1
 >>4) > 4)

271 i((
PvXrCome
&& (
bDeviS
 =
CONFIGURED
))

273 
Sd_Bufr
[1] = (
ut8_t
)(
ADC_CvdVueX
 >>4);

276 
	`USB_SIL_Wre
(
EP1_IN
, (
ut8_t
*
Sd_Bufr
, 2);

277 
	`SEPTxVid
(
ENDP1
);

278 
ADC_CvdVueX_1
 = 
ADC_CvdVueX
;

279 
PvXrCome
 = 0;

283 
	`DMA_CˬFg
(
DMA1_FLAG_TC1
);

284 
	}
}

293 #i
defed
(
STM32L1XX_MD
|| defed(
STM32L1XX_HD
)|| defed(
STM32L1XX_MD_PLUS
)

294 
	$EXTI0_IRQHdr
()

295 #i
	`defed
 (
STM32F37X
)

296 
	$EXTI2_TS_IRQHdr
()

298 
	$EXTI9_5_IRQHdr
()

301 if(
	`EXTI_GITStus
(
KEY_BUTTON_EXTI_LINE
!
RESET
)

303 i((
PvXrCome
&& (
bDeviS
 =
CONFIGURED
))

305 
Sd_Bufr
[0] = 0x05;

306 #i
	`defed
(
STM32L1XX_HD
)|| defed(
STM32L1XX_MD_PLUS
)

307 i(!
	`STM_EVAL_PBGS
(
Bu_KEY
=
B_RESET
)

309 i(
	`STM_EVAL_PBGS
(
Bu_KEY
=
B_RESET
)

312 
Sd_Bufr
[1] = 0x01;

316 
Sd_Bufr
[1] = 0x00;

320 
	`USB_SIL_Wre
(
EP1_IN
, (
ut8_t
*
Sd_Bufr
, 2);

321 
	`SEPTxVid
(
ENDP1
);

322 
PvXrCome
 = 0;

325 
	`EXTI_CˬITPdgB
(
KEY_BUTTON_EXTI_LINE
);

327 
	}
}

328 #i!
defed
(
STM32L1XX_MD
&& !defed(
STM32L1XX_HD
&& !defed(
STM32L1XX_MD_PLUS
)&& ! defed (
STM32F37X
&& ! defed (
STM32F30X
)

336 
	$EXTI15_10_IRQHdr
()

338 if(
	`EXTI_GITStus
(
TAMPER_BUTTON_EXTI_LINE
!
RESET
)

340 i((
PvXrCome
&& (
bDeviS
 =
CONFIGURED
))

342 
Sd_Bufr
[0] = 0x06;

344 i(
	`STM_EVAL_PBGS
(
Bu_TAMPER
=
B_RESET
)

346 
Sd_Bufr
[1] = 0x01;

350 
Sd_Bufr
[1] = 0x00;

354 
	`USB_SIL_Wre
(
EP1_IN
, (
ut8_t
*
Sd_Bufr
, 2);

356 
	`SEPTxVid
(
ENDP1
);

358 
PvXrCome
 = 0;

361 
	`EXTI_CˬITPdgB
(
TAMPER_BUTTON_EXTI_LINE
);

363 
	}
}

375 #i
defed
(
STM32L1XX_MD
|| defed(
STM32L1XX_HD
)|| defed(
STM32L1XX_MD_PLUS
)

376 
	$USB_FS_WKUP_IRQHdr
()

378 
	$USBWakeUp_IRQHdr
()

381 
	`EXTI_CˬITPdgB
(
EXTI_Le18
);

382 
	}
}

	@src/system_stm32f10x.c

71 
	~"m32f10x.h
"

112 #i
defed
 (
STM32F10X_LD_VL
|| (defed 
STM32F10X_MD_VL
|| (defed 
STM32F10X_HD_VL
)

114 
	#SYSCLK_FREQ_24MHz
 24000000

	)

121 
	#SYSCLK_FREQ_72MHz
 72000000

	)

127 #i
defed
 (
STM32F10X_HD
|| (defed 
STM32F10X_XL
|| (defed 
STM32F10X_HD_VL
)

134 
	#VECT_TAB_OFFSET
 0x0

	)

157 #ifde
SYSCLK_FREQ_HSE


158 
ut32_t
 
	gSyemCeClock
 = 
SYSCLK_FREQ_HSE
;

159 #i
defed
 
SYSCLK_FREQ_24MHz


160 
ut32_t
 
	gSyemCeClock
 = 
SYSCLK_FREQ_24MHz
;

161 #i
defed
 
SYSCLK_FREQ_36MHz


162 
ut32_t
 
	gSyemCeClock
 = 
SYSCLK_FREQ_36MHz
;

163 #i
defed
 
SYSCLK_FREQ_48MHz


164 
ut32_t
 
	gSyemCeClock
 = 
SYSCLK_FREQ_48MHz
;

165 #i
defed
 
SYSCLK_FREQ_56MHz


166 
ut32_t
 
	gSyemCeClock
 = 
SYSCLK_FREQ_56MHz
;

167 #i
defed
 
SYSCLK_FREQ_72MHz


168 
ut32_t
 
	gSyemCeClock
 = 
SYSCLK_FREQ_72MHz
;

170 
ut32_t
 
	gSyemCeClock
 = 
HSI_VALUE
;

173 
__I
 
ut8_t
 
	gAHBPscTab
[16] = {0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 4, 6, 7, 8, 9};

182 
SSysClock
();

184 #ifde
SYSCLK_FREQ_HSE


185 
SSysClockToHSE
();

186 #i
defed
 
SYSCLK_FREQ_24MHz


187 
SSysClockTo24
();

188 #i
defed
 
SYSCLK_FREQ_36MHz


189 
SSysClockTo36
();

190 #i
defed
 
SYSCLK_FREQ_48MHz


191 
SSysClockTo48
();

192 #i
defed
 
SYSCLK_FREQ_56MHz


193 
SSysClockTo56
();

194 #i
defed
 
SYSCLK_FREQ_72MHz


195 
SSysClockTo72
();

198 #ifde
DATA_IN_ExtSRAM


199 
SyemIn_ExtMemC
();

218 
	$SyemIn
 ()

222 
RCC
->
CR
 |(
ut32_t
)0x00000001;

226 
RCC
->
CFGR
 &(
ut32_t
)0xF8FF0000;

229 
RCC
->
CR
 &(
ut32_t
)0xFEF6FFFF;

232 
RCC
->
CR
 &(
ut32_t
)0xFFFBFFFF;

235 
RCC
->
CFGR
 &(
ut32_t
)0xFF80FFFF;

237 #i
	`defed
 (
STM32F10X_LD_VL
|| defed (
STM32F10X_MD_VL
|| (
defed
 
STM32F10X_HD_VL
)

239 
RCC
->
CIR
 = 0x009F0000;

242 
RCC
->
CFGR2
 = 0x00000000;

245 
RCC
->
CIR
 = 0x009F0000;

248 #i
	`defed
 (
STM32F10X_HD
|| (
defed
 
STM32F10X_XL
|| (defed 
STM32F10X_HD_VL
)

249 #ifde
DATA_IN_ExtSRAM


250 
	`SyemIn_ExtMemC
();

256 
	`SSysClock
();

258 #ifde
VECT_TAB_SRAM


259 
SCB
->
VTOR
 = 
SRAM_BASE
 | 
VECT_TAB_OFFSET
;

261 
SCB
->
VTOR
 = 
FLASH_BASE
 | 
VECT_TAB_OFFSET
;

263 
	}
}

300 
	$SyemCeClockUpde
 ()

302 
ut32_t
 
tmp
 = 0, 
lmu
 = 0, 
lsour
 = 0;

304 #i
	`defed
 (
STM32F10X_LD_VL
|| defed (
STM32F10X_MD_VL
|| (
defed
 
STM32F10X_HD_VL
)

305 
ut32_t
 
ediv1
 = 0;

309 
tmp
 = 
RCC
->
CFGR
 & 
RCC_CFGR_SWS
;

311 
tmp
)

314 
SyemCeClock
 = 
HSI_VALUE
;

317 
SyemCeClock
 = 
HSE_VALUE
;

322 
lmu
 = 
RCC
->
CFGR
 & 
RCC_CFGR_PLLMULL
;

323 
lsour
 = 
RCC
->
CFGR
 & 
RCC_CFGR_PLLSRC
;

325 
lmu
 = (llmull >> 18) + 2;

327 i(
lsour
 == 0x00)

330 
SyemCeClock
 = (
HSI_VALUE
 >> 1* 
lmu
;

334 #i
	`defed
 (
STM32F10X_LD_VL
|| defed (
STM32F10X_MD_VL
|| (
defed
 
STM32F10X_HD_VL
)

335 
ediv1
 = (
RCC
->
CFGR2
 & 
RCC_CFGR2_PREDIV1
) + 1;

337 
SyemCeClock
 = (
HSE_VALUE
 / 
ediv1
* 
lmu
;

340 i((
RCC
->
CFGR
 & 
RCC_CFGR_PLLXTPRE
!(
ut32_t
)
RESET
)

342 
SyemCeClock
 = (
HSE_VALUE
 >> 1* 
lmu
;

346 
SyemCeClock
 = 
HSE_VALUE
 * 
lmu
;

354 
SyemCeClock
 = 
HSI_VALUE
;

360 
tmp
 = 
AHBPscTab
[((
RCC
->
CFGR
 & 
RCC_CFGR_HPRE
) >> 4)];

362 
SyemCeClock
 >>
tmp
;

363 
	}
}

370 
	$SSysClock
()

372 #ifde
SYSCLK_FREQ_HSE


373 
	`SSysClockToHSE
();

374 #i
defed
 
SYSCLK_FREQ_24MHz


375 
	`SSysClockTo24
();

376 #i
defed
 
SYSCLK_FREQ_36MHz


377 
	`SSysClockTo36
();

378 #i
defed
 
SYSCLK_FREQ_48MHz


379 
	`SSysClockTo48
();

380 #i
defed
 
SYSCLK_FREQ_56MHz


381 
	`SSysClockTo56
();

382 #i
defed
 
SYSCLK_FREQ_72MHz


383 
	`SSysClockTo72
();

388 
	}
}

396 #ifde
DATA_IN_ExtSRAM


406 
	$SyemIn_ExtMemC
()

412 
RCC
->
AHBENR
 = 0x00000114;

415 
RCC
->
APB2ENR
 = 0x000001E0;

423 
GPIOD
->
CRL
 = 0x44BB44BB;

424 
GPIOD
->
CRH
 = 0xBBBBBBBB;

426 
GPIOE
->
CRL
 = 0xB44444BB;

427 
GPIOE
->
CRH
 = 0xBBBBBBBB;

429 
GPIOF
->
CRL
 = 0x44BBBBBB;

430 
GPIOF
->
CRH
 = 0xBBBB4444;

432 
GPIOG
->
CRL
 = 0x44BBBBBB;

433 
GPIOG
->
CRH
 = 0x44444B44;

438 
FSMC_Bk1
->
BTCR
[4] = 0x00001011;

439 
FSMC_Bk1
->
BTCR
[5] = 0x00000200;

440 
	}
}

443 #ifde
SYSCLK_FREQ_HSE


451 
	$SSysClockToHSE
()

453 
__IO
 
ut32_t
 
SUpCou
 = 0, 
HSEStus
 = 0;

457 
RCC
->
CR
 |((
ut32_t
)
RCC_CR_HSEON
);

462 
HSEStus
 = 
RCC
->
CR
 & 
RCC_CR_HSERDY
;

463 
SUpCou
++;

464 } (
HSEStus
 =0&& (
SUpCou
 !
HSE_STARTUP_TIMEOUT
));

466 i((
RCC
->
CR
 & 
RCC_CR_HSERDY
!
RESET
)

468 
HSEStus
 = (
ut32_t
)0x01;

472 
HSEStus
 = (
ut32_t
)0x00;

475 i(
HSEStus
 =(
ut32_t
)0x01)

478 #i!
defed
 
STM32F10X_LD_VL
 && !defed 
STM32F10X_MD_VL
 && !defed 
STM32F10X_HD_VL


480 
FLASH
->
ACR
 |
FLASH_ACR_PRFTBE
;

483 
FLASH
->
ACR
 &(
ut32_t
)((ut32_t)~
FLASH_ACR_LATENCY
);

485 
FLASH
->
ACR
 |(
ut32_t
)
FLASH_ACR_LATENCY_0
;

489 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_HPRE_DIV1
;

492 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE2_DIV1
;

495 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE1_DIV1
;

498 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_SW
));

499 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_SW_HSE
;

502 (
RCC
->
CFGR
 & (
ut32_t
)
RCC_CFGR_SWS
) != (uint32_t)0x04)

510 
	}
}

511 #i
defed
 
SYSCLK_FREQ_24MHz


519 
	$SSysClockTo24
()

521 
__IO
 
ut32_t
 
SUpCou
 = 0, 
HSEStus
 = 0;

525 
RCC
->
CR
 |((
ut32_t
)
RCC_CR_HSEON
);

530 
HSEStus
 = 
RCC
->
CR
 & 
RCC_CR_HSERDY
;

531 
SUpCou
++;

532 } (
HSEStus
 =0&& (
SUpCou
 !
HSE_STARTUP_TIMEOUT
));

534 i((
RCC
->
CR
 & 
RCC_CR_HSERDY
!
RESET
)

536 
HSEStus
 = (
ut32_t
)0x01;

540 
HSEStus
 = (
ut32_t
)0x00;

543 i(
HSEStus
 =(
ut32_t
)0x01)

545 #i!
defed
 
STM32F10X_LD_VL
 && !defed 
STM32F10X_MD_VL
 && !defed 
STM32F10X_HD_VL


547 
FLASH
->
ACR
 |
FLASH_ACR_PRFTBE
;

550 
FLASH
->
ACR
 &(
ut32_t
)((ut32_t)~
FLASH_ACR_LATENCY
);

551 
FLASH
->
ACR
 |(
ut32_t
)
FLASH_ACR_LATENCY_0
;

555 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_HPRE_DIV1
;

558 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE2_DIV1
;

561 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE1_DIV1
;

563 #i
	`defed
 (
STM32F10X_LD_VL
|| defed (
STM32F10X_MD_VL
|| defed (
STM32F10X_HD_VL
)

565 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_PLLSRC
 | 
RCC_CFGR_PLLXTPRE
 | 
RCC_CFGR_PLLMULL
));

566 
RCC
->
CFGR
 |(
ut32_t
)(
RCC_CFGR_PLLSRC_PREDIV1
 | 
RCC_CFGR_PLLXTPRE_PREDIV1_Div2
 | 
RCC_CFGR_PLLMULL6
);

569 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_PLLSRC
 | 
RCC_CFGR_PLLXTPRE
 | 
RCC_CFGR_PLLMULL
));

570 
RCC
->
CFGR
 |(
ut32_t
)(
RCC_CFGR_PLLSRC_HSE
 | 
RCC_CFGR_PLLXTPRE_HSE_Div2
 | 
RCC_CFGR_PLLMULL6
);

574 
RCC
->
CR
 |
RCC_CR_PLLON
;

577 (
RCC
->
CR
 & 
RCC_CR_PLLRDY
) == 0)

582 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_SW
));

583 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_SW_PLL
;

586 (
RCC
->
CFGR
 & (
ut32_t
)
RCC_CFGR_SWS
) != (uint32_t)0x08)

594 
	}
}

595 #i
defed
 
SYSCLK_FREQ_36MHz


603 
	$SSysClockTo36
()

605 
__IO
 
ut32_t
 
SUpCou
 = 0, 
HSEStus
 = 0;

609 
RCC
->
CR
 |((
ut32_t
)
RCC_CR_HSEON
);

614 
HSEStus
 = 
RCC
->
CR
 & 
RCC_CR_HSERDY
;

615 
SUpCou
++;

616 } (
HSEStus
 =0&& (
SUpCou
 !
HSE_STARTUP_TIMEOUT
));

618 i((
RCC
->
CR
 & 
RCC_CR_HSERDY
!
RESET
)

620 
HSEStus
 = (
ut32_t
)0x01;

624 
HSEStus
 = (
ut32_t
)0x00;

627 i(
HSEStus
 =(
ut32_t
)0x01)

630 
FLASH
->
ACR
 |
FLASH_ACR_PRFTBE
;

633 
FLASH
->
ACR
 &(
ut32_t
)((ut32_t)~
FLASH_ACR_LATENCY
);

634 
FLASH
->
ACR
 |(
ut32_t
)
FLASH_ACR_LATENCY_1
;

637 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_HPRE_DIV1
;

640 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE2_DIV1
;

643 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE1_DIV1
;

646 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_PLLSRC
 | 
RCC_CFGR_PLLXTPRE
 | 
RCC_CFGR_PLLMULL
));

647 
RCC
->
CFGR
 |(
ut32_t
)(
RCC_CFGR_PLLSRC_HSE
 | 
RCC_CFGR_PLLXTPRE_HSE_Div2
 | 
RCC_CFGR_PLLMULL9
);

650 
RCC
->
CR
 |
RCC_CR_PLLON
;

653 (
RCC
->
CR
 & 
RCC_CR_PLLRDY
) == 0)

658 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_SW
));

659 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_SW_PLL
;

662 (
RCC
->
CFGR
 & (
ut32_t
)
RCC_CFGR_SWS
) != (uint32_t)0x08)

670 
	}
}

671 #i
defed
 
SYSCLK_FREQ_48MHz


679 
	$SSysClockTo48
()

681 
__IO
 
ut32_t
 
SUpCou
 = 0, 
HSEStus
 = 0;

685 
RCC
->
CR
 |((
ut32_t
)
RCC_CR_HSEON
);

690 
HSEStus
 = 
RCC
->
CR
 & 
RCC_CR_HSERDY
;

691 
SUpCou
++;

692 } (
HSEStus
 =0&& (
SUpCou
 !
HSE_STARTUP_TIMEOUT
));

694 i((
RCC
->
CR
 & 
RCC_CR_HSERDY
!
RESET
)

696 
HSEStus
 = (
ut32_t
)0x01;

700 
HSEStus
 = (
ut32_t
)0x00;

703 i(
HSEStus
 =(
ut32_t
)0x01)

706 
FLASH
->
ACR
 |
FLASH_ACR_PRFTBE
;

709 
FLASH
->
ACR
 &(
ut32_t
)((ut32_t)~
FLASH_ACR_LATENCY
);

710 
FLASH
->
ACR
 |(
ut32_t
)
FLASH_ACR_LATENCY_1
;

713 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_HPRE_DIV1
;

716 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE2_DIV1
;

719 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE1_DIV2
;

722 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_PLLSRC
 | 
RCC_CFGR_PLLXTPRE
 | 
RCC_CFGR_PLLMULL
));

723 
RCC
->
CFGR
 |(
ut32_t
)(
RCC_CFGR_PLLSRC_HSE
 | 
RCC_CFGR_PLLMULL6
);

726 
RCC
->
CR
 |
RCC_CR_PLLON
;

729 (
RCC
->
CR
 & 
RCC_CR_PLLRDY
) == 0)

734 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_SW
));

735 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_SW_PLL
;

738 (
RCC
->
CFGR
 & (
ut32_t
)
RCC_CFGR_SWS
) != (uint32_t)0x08)

746 
	}
}

748 #i
defed
 
SYSCLK_FREQ_56MHz


756 
	$SSysClockTo56
()

758 
__IO
 
ut32_t
 
SUpCou
 = 0, 
HSEStus
 = 0;

762 
RCC
->
CR
 |((
ut32_t
)
RCC_CR_HSEON
);

767 
HSEStus
 = 
RCC
->
CR
 & 
RCC_CR_HSERDY
;

768 
SUpCou
++;

769 } (
HSEStus
 =0&& (
SUpCou
 !
HSE_STARTUP_TIMEOUT
));

771 i((
RCC
->
CR
 & 
RCC_CR_HSERDY
!
RESET
)

773 
HSEStus
 = (
ut32_t
)0x01;

777 
HSEStus
 = (
ut32_t
)0x00;

780 i(
HSEStus
 =(
ut32_t
)0x01)

783 
FLASH
->
ACR
 |
FLASH_ACR_PRFTBE
;

786 
FLASH
->
ACR
 &(
ut32_t
)((ut32_t)~
FLASH_ACR_LATENCY
);

787 
FLASH
->
ACR
 |(
ut32_t
)
FLASH_ACR_LATENCY_2
;

790 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_HPRE_DIV1
;

793 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE2_DIV1
;

796 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE1_DIV2
;

800 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_PLLSRC
 | 
RCC_CFGR_PLLXTPRE
 | 
RCC_CFGR_PLLMULL
));

801 
RCC
->
CFGR
 |(
ut32_t
)(
RCC_CFGR_PLLSRC_HSE
 | 
RCC_CFGR_PLLMULL7
);

804 
RCC
->
CR
 |
RCC_CR_PLLON
;

807 (
RCC
->
CR
 & 
RCC_CR_PLLRDY
) == 0)

812 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_SW
));

813 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_SW_PLL
;

816 (
RCC
->
CFGR
 & (
ut32_t
)
RCC_CFGR_SWS
) != (uint32_t)0x08)

824 
	}
}

826 #i
defed
 
SYSCLK_FREQ_72MHz


834 
	$SSysClockTo72
()

836 
__IO
 
ut32_t
 
SUpCou
 = 0, 
HSEStus
 = 0;

840 
RCC
->
CR
 |((
ut32_t
)
RCC_CR_HSEON
);

845 
HSEStus
 = 
RCC
->
CR
 & 
RCC_CR_HSERDY
;

846 
SUpCou
++;

847 } (
HSEStus
 =0&& (
SUpCou
 !
HSE_STARTUP_TIMEOUT
));

849 i((
RCC
->
CR
 & 
RCC_CR_HSERDY
!
RESET
)

851 
HSEStus
 = (
ut32_t
)0x01;

855 
HSEStus
 = (
ut32_t
)0x00;

858 i(
HSEStus
 =(
ut32_t
)0x01)

861 
FLASH
->
ACR
 |
FLASH_ACR_PRFTBE
;

864 
FLASH
->
ACR
 &(
ut32_t
)((ut32_t)~
FLASH_ACR_LATENCY
);

865 
FLASH
->
ACR
 |(
ut32_t
)
FLASH_ACR_LATENCY_2
;

869 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_HPRE_DIV1
;

872 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE2_DIV1
;

875 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE1_DIV2
;

878 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_PLLSRC
 | 
RCC_CFGR_PLLXTPRE
 |

879 
RCC_CFGR_PLLMULL
));

880 
RCC
->
CFGR
 |(
ut32_t
)(
RCC_CFGR_PLLSRC_HSE
 | 
RCC_CFGR_PLLMULL9
);

883 
RCC
->
CR
 |
RCC_CR_PLLON
;

886 (
RCC
->
CR
 & 
RCC_CR_PLLRDY
) == 0)

891 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_SW
));

892 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_SW_PLL
;

895 (
RCC
->
CFGR
 & (
ut32_t
)
RCC_CFGR_SWS
) != (uint32_t)0x08)

903 
	}
}

	@src/system_stm32f30x.c

102 
	~"m32f30x.h
"

122 
	#VECT_TAB_OFFSET
 0x0

	)

140 
ut32_t
 
	gSyemCeClock
 = 72000000;

142 
__I
 
ut8_t
 
	gAHBPscTab
[16] = {0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 4, 6, 7, 8, 9};

152 
SSysClock
();

169 
	$SyemIn
()

172 #i(
__FPU_PRESENT
 =1&& (
__FPU_USED
 == 1)

173 
SCB
->
CPACR
 |= ((3UL << 10*2)|(3UL << 11*2));

178 
RCC
->
CR
 |(
ut32_t
)0x00000001;

181 
RCC
->
CFGR
 &= 0xF87FC00C;

184 
RCC
->
CR
 &(
ut32_t
)0xFEF6FFFF;

187 
RCC
->
CR
 &(
ut32_t
)0xFFFBFFFF;

190 
RCC
->
CFGR
 &(
ut32_t
)0xFF80FFFF;

193 
RCC
->
CFGR2
 &(
ut32_t
)0xFFFFFFF0;

196 
RCC
->
CFGR3
 &(
ut32_t
)0xFF00FCCC;

199 
RCC
->
CIR
 = 0x00000000;

203 
	`SSysClock
();

205 #ifde
VECT_TAB_SRAM


206 
SCB
->
VTOR
 = 
SRAM_BASE
 | 
VECT_TAB_OFFSET
;

208 
SCB
->
VTOR
 = 
FLASH_BASE
 | 
VECT_TAB_OFFSET
;

210 
	}
}

248 
	$SyemCeClockUpde
 ()

250 
ut32_t
 
tmp
 = 0, 
lmu
 = 0, 
lsour
 = 0, 
ediv1
 = 0;

253 
tmp
 = 
RCC
->
CFGR
 & 
RCC_CFGR_SWS
;

255 
tmp
)

258 
SyemCeClock
 = 
HSI_VALUE
;

261 
SyemCeClock
 = 
HSE_VALUE
;

265 
lmu
 = 
RCC
->
CFGR
 & 
RCC_CFGR_PLLMULL
;

266 
lsour
 = 
RCC
->
CFGR
 & 
RCC_CFGR_PLLSRC
;

267 
lmu
 = (llmull >> 18) + 2;

269 i(
lsour
 == 0x00)

272 
SyemCeClock
 = (
HSI_VALUE
 >> 1* 
lmu
;

276 
ediv1
 = (
RCC
->
CFGR2
 & 
RCC_CFGR2_PREDIV1
) + 1;

278 
SyemCeClock
 = (
HSE_VALUE
 / 
ediv1
* 
lmu
;

282 
SyemCeClock
 = 
HSI_VALUE
;

287 
tmp
 = 
AHBPscTab
[((
RCC
->
CFGR
 & 
RCC_CFGR_HPRE
) >> 4)];

289 
SyemCeClock
 >>
tmp
;

290 
	}
}

300 
	$SSysClock
()

302 
__IO
 
ut32_t
 
SUpCou
 = 0, 
HSEStus
 = 0;

310 
RCC
->
CR
 |((
ut32_t
)
RCC_CR_HSEON
);

315 
HSEStus
 = 
RCC
->
CR
 & 
RCC_CR_HSERDY
;

316 
SUpCou
++;

317 } (
HSEStus
 =0&& (
SUpCou
 !
HSE_STARTUP_TIMEOUT
));

319 i((
RCC
->
CR
 & 
RCC_CR_HSERDY
!
RESET
)

321 
HSEStus
 = (
ut32_t
)0x01;

325 
HSEStus
 = (
ut32_t
)0x00;

328 i(
HSEStus
 =(
ut32_t
)0x01)

331 
FLASH
->
ACR
 = 
FLASH_ACR_PRFTBE
 | (
ut32_t
)
FLASH_ACR_LATENCY_1
;

334 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_HPRE_DIV1
;

337 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE2_DIV1
;

340 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE1_DIV2
;

343 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_PLLSRC
 | 
RCC_CFGR_PLLXTPRE
 | 
RCC_CFGR_PLLMULL
));

344 
RCC
->
CFGR
 |(
ut32_t
)(
RCC_CFGR_PLLSRC_PREDIV1
 | 
RCC_CFGR_PLLXTPRE_PREDIV1
 | 
RCC_CFGR_PLLMULL9
);

347 
RCC
->
CR
 |
RCC_CR_PLLON
;

350 (
RCC
->
CR
 & 
RCC_CR_PLLRDY
) == 0)

355 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_SW
));

356 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_SW_PLL
;

359 (
RCC
->
CFGR
 & (
ut32_t
)
RCC_CFGR_SWS
!(ut32_t)
RCC_CFGR_SWS_PLL
)

367 
	}
}

	@src/system_stm32f37x.c

103 
	~"m32f37x.h
"

124 
	#VECT_TAB_OFFSET
 0x0

	)

141 
ut32_t
 
	gSyemCeClock
 = 72000000;

142 
__I
 
ut8_t
 
	gAHBPscTab
[16] = {0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 4, 6, 7, 8, 9};

152 
SSysClock
();

169 
	$SyemIn
 ()

172 #i(
__FPU_PRESENT
 =1&& (
__FPU_USED
 == 1)

173 
SCB
->
CPACR
 |= ((3UL << 10*2)|(3UL << 11*2));

177 
RCC
->
CR
 |(
ut32_t
)0x00000001;

180 
RCC
->
CFGR
 &(
ut32_t
)0x00FF0000;

183 
RCC
->
CR
 &(
ut32_t
)0xFEF6FFFF;

186 
RCC
->
CR
 &(
ut32_t
)0xFFFBFFFF;

189 
RCC
->
CFGR
 &(
ut32_t
)0xFF80FFFF;

192 
RCC
->
CFGR2
 &(
ut32_t
)0xFFFFFFF0;

195 
RCC
->
CFGR3
 &(
ut32_t
)0xFFF0F8C;

198 
RCC
->
CIR
 = 0x00000000;

201 
	`SSysClock
();

204 #ifde
VECT_TAB_SRAM


205 
SCB
->
VTOR
 = 
SRAM_BASE
 | 
VECT_TAB_OFFSET
;

207 
SCB
->
VTOR
 = 
FLASH_BASE
 | 
VECT_TAB_OFFSET
;

209 
	}
}

246 
	$SyemCeClockUpde
 ()

248 
ut32_t
 
tmp
 = 0, 
lmu
 = 0, 
lsour
 = 0, 
ediv1
 = 0;

251 
tmp
 = 
RCC
->
CFGR
 & 
RCC_CFGR_SWS
;

253 
tmp
)

256 
SyemCeClock
 = 
HSI_VALUE
;

259 
SyemCeClock
 = 
HSE_VALUE
;

263 
lmu
 = 
RCC
->
CFGR
 & 
RCC_CFGR_PLLMULL
;

264 
lsour
 = 
RCC
->
CFGR
 & 
RCC_CFGR_PLLSRC
;

265 
lmu
 = (llmull >> 18) + 2;

267 i(
lsour
 == 0x00)

270 
SyemCeClock
 = (
HSI_VALUE
 >> 1* 
lmu
;

274 
ediv1
 = (
RCC
->
CFGR2
 & 
RCC_CFGR2_PREDIV1
) + 1;

276 
SyemCeClock
 = (
HSE_VALUE
 / 
ediv1
* 
lmu
;

280 
SyemCeClock
 = 
HSI_VALUE
;

285 
tmp
 = 
AHBPscTab
[((
RCC
->
CFGR
 & 
RCC_CFGR_HPRE
) >> 4)];

287 
SyemCeClock
 >>
tmp
;

288 
	}
}

298 
	$SSysClock
()

300 
__IO
 
ut32_t
 
SUpCou
 = 0, 
HSEStus
 = 0;

308 
RCC
->
CR
 |((
ut32_t
)
RCC_CR_HSEON
);

313 
HSEStus
 = 
RCC
->
CR
 & 
RCC_CR_HSERDY
;

314 
SUpCou
++;

315 } (
HSEStus
 =0&& (
SUpCou
 !
HSE_STARTUP_TIMEOUT
));

317 i((
RCC
->
CR
 & 
RCC_CR_HSERDY
!
RESET
)

319 
HSEStus
 = (
ut32_t
)0x01;

323 
HSEStus
 = (
ut32_t
)0x00;

326 i(
HSEStus
 =(
ut32_t
)0x01)

329 
FLASH
->
ACR
 = 
FLASH_ACR_PRFTBE
 | (
ut32_t
)
FLASH_ACR_LATENCY_1
;

332 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_HPRE_DIV1
;

335 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE2_DIV1
;

338 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE1_DIV2
;

341 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_PLLSRC
 | 
RCC_CFGR_PLLXTPRE
 | 
RCC_CFGR_PLLMULL
));

342 
RCC
->
CFGR
 |(
ut32_t
)(
RCC_CFGR_PLLSRC_PREDIV1
 | 
RCC_CFGR_PLLXTPRE_PREDIV1
 | 
RCC_CFGR_PLLMULL9
);

345 
RCC
->
CR
 |
RCC_CR_PLLON
;

348 (
RCC
->
CR
 & 
RCC_CR_PLLRDY
) == 0)

353 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_SW
));

354 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_SW_PLL
;

357 (
RCC
->
CFGR
 & (
ut32_t
)
RCC_CFGR_SWS
!(ut32_t)
RCC_CFGR_SWS_PLL
)

365 
	}
}

	@src/system_stm32l1xx.c

107 
	~"m32l1xx.h
"

132 
	#VECT_TAB_OFFSET
 0x0

	)

149 
ut32_t
 
	gSyemCeClock
 = 32000000;

150 
__I
 
ut8_t
 
	gPLLMulTab
[9] = {3, 4, 6, 8, 12, 16, 24, 32, 48};

151 
__I
 
ut8_t
 
	gAHBPscTab
[16] = {0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 4, 6, 7, 8, 9};

161 
SSysClock
();

162 #ifde
DATA_IN_ExtSRAM


163 
SyemIn_ExtMemC
();

181 
	$SyemIn
 ()

184 
RCC
->
CR
 |(
ut32_t
)0x00000100;

187 
RCC
->
CFGR
 &(
ut32_t
)0x88FFC00C;

190 
RCC
->
CR
 &(
ut32_t
)0xEEFEFFFE;

193 
RCC
->
CR
 &(
ut32_t
)0xFFFBFFFF;

196 
RCC
->
CFGR
 &(
ut32_t
)0xFF02FFFF;

199 
RCC
->
CIR
 = 0x00000000;

201 #ifde
DATA_IN_ExtSRAM


202 
	`SyemIn_ExtMemC
();

206 
	`SSysClock
();

208 #ifde
VECT_TAB_SRAM


209 
SCB
->
VTOR
 = 
SRAM_BASE
 | 
VECT_TAB_OFFSET
;

211 
SCB
->
VTOR
 = 
FLASH_BASE
 | 
VECT_TAB_OFFSET
;

213 
	}
}

253 
	$SyemCeClockUpde
 ()

255 
ut32_t
 
tmp
 = 0, 
lmul
 = 0, 
ldiv
 = 0, 
lsour
 = 0, 
msge
 = 0;

258 
tmp
 = 
RCC
->
CFGR
 & 
RCC_CFGR_SWS
;

260 
tmp
)

263 
msge
 = (
RCC
->
ICSCR
 & 
RCC_ICSCR_MSIRANGE
) >> 13;

264 
SyemCeClock
 = (32768 * (1 << (
msge
 + 1)));

267 
SyemCeClock
 = 
HSI_VALUE
;

270 
SyemCeClock
 = 
HSE_VALUE
;

274 
lmul
 = 
RCC
->
CFGR
 & 
RCC_CFGR_PLLMUL
;

275 
ldiv
 = 
RCC
->
CFGR
 & 
RCC_CFGR_PLLDIV
;

276 
lmul
 = 
PLLMulTab
[(pllmul >> 18)];

277 
ldiv
 = (plldiv >> 22) + 1;

279 
lsour
 = 
RCC
->
CFGR
 & 
RCC_CFGR_PLLSRC
;

281 i(
lsour
 == 0x00)

284 
SyemCeClock
 = (((
HSI_VALUE
* 
lmul
/ 
ldiv
);

289 
SyemCeClock
 = (((
HSE_VALUE
* 
lmul
/ 
ldiv
);

293 
msge
 = (
RCC
->
ICSCR
 & 
RCC_ICSCR_MSIRANGE
) >> 13;

294 
SyemCeClock
 = (32768 * (1 << (
msge
 + 1)));

299 
tmp
 = 
AHBPscTab
[((
RCC
->
CFGR
 & 
RCC_CFGR_HPRE
) >> 4)];

301 
SyemCeClock
 >>
tmp
;

302 
	}
}

312 
	$SSysClock
()

314 
__IO
 
ut32_t
 
SUpCou
 = 0, 
HSEStus
 = 0;

318 
RCC
->
CR
 |((
ut32_t
)
RCC_CR_HSEON
);

323 
HSEStus
 = 
RCC
->
CR
 & 
RCC_CR_HSERDY
;

324 
SUpCou
++;

325 } (
HSEStus
 =0&& (
SUpCou
 !
HSE_STARTUP_TIMEOUT
));

327 i((
RCC
->
CR
 & 
RCC_CR_HSERDY
!
RESET
)

329 
HSEStus
 = (
ut32_t
)0x01;

333 
HSEStus
 = (
ut32_t
)0x00;

336 i(
HSEStus
 =(
ut32_t
)0x01)

339 
FLASH
->
ACR
 |
FLASH_ACR_ACC64
;

342 
FLASH
->
ACR
 |
FLASH_ACR_PRFTEN
;

345 
FLASH
->
ACR
 |
FLASH_ACR_LATENCY
;

348 
RCC
->
APB1ENR
 |
RCC_APB1ENR_PWREN
;

351 
PWR
->
CR
 = 
PWR_CR_VOS_0
;

354 (
PWR
->
CSR
 & 
PWR_CSR_VOSF
!
RESET
)

359 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_HPRE_DIV1
;

362 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE2_DIV1
;

365 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_PPRE1_DIV1
;

368 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_PLLSRC
 | 
RCC_CFGR_PLLMUL
 |

369 
RCC_CFGR_PLLDIV
));

370 
RCC
->
CFGR
 |(
ut32_t
)(
RCC_CFGR_PLLSRC_HSE
 | 
RCC_CFGR_PLLMUL12
 | 
RCC_CFGR_PLLDIV3
);

373 
RCC
->
CR
 |
RCC_CR_PLLON
;

376 (
RCC
->
CR
 & 
RCC_CR_PLLRDY
) == 0)

381 
RCC
->
CFGR
 &(
ut32_t
)((ut32_t)~(
RCC_CFGR_SW
));

382 
RCC
->
CFGR
 |(
ut32_t
)
RCC_CFGR_SW_PLL
;

385 (
RCC
->
CFGR
 & (
ut32_t
)
RCC_CFGR_SWS
!(ut32_t)
RCC_CFGR_SWS_PLL
)

394 
	}
}

396 #ifde
DATA_IN_ExtSRAM


405 
	$SyemIn_ExtMemC
()

428 
RCC
->
AHBENR
 = 0x000080D8;

431 
GPIOD
->
AFR
[0] = 0x00CC00CC;

432 
GPIOD
->
AFR
[1] = 0xCCCCCCCC;

434 
GPIOD
->
MODER
 = 0xAAAA0A0A;

436 
GPIOD
->
OSPEEDR
 = 0xFFFF0F0F;

438 
GPIOD
->
OTYPER
 = 0x00000000;

440 
GPIOD
->
PUPDR
 = 0x00000000;

443 
GPIOE
->
AFR
[0] = 0xC00000CC;

444 
GPIOE
->
AFR
[1] = 0xCCCCCCCC;

446 
GPIOE
->
MODER
 = 0xAAAA800A;

448 
GPIOE
->
OSPEEDR
 = 0xFFFFC00F;

450 
GPIOE
->
OTYPER
 = 0x00000000;

452 
GPIOE
->
PUPDR
 = 0x00000000;

455 
GPIOF
->
AFR
[0] = 0x00CCCCCC;

456 
GPIOF
->
AFR
[1] = 0xCCCC0000;

458 
GPIOF
->
MODER
 = 0xAA000AAA;

460 
GPIOF
->
OSPEEDR
 = 0xFF000FFF;

462 
GPIOF
->
OTYPER
 = 0x00000000;

464 
GPIOF
->
PUPDR
 = 0x00000000;

467 
GPIOG
->
AFR
[0] = 0x00CCCCCC;

468 
GPIOG
->
AFR
[1] = 0x00000C00;

470 
GPIOG
->
MODER
 = 0x00200AAA;

472 
GPIOG
->
OSPEEDR
 = 0x00300FFF;

474 
GPIOG
->
OTYPER
 = 0x00000000;

476 
GPIOG
->
PUPDR
 = 0x00000000;

480 
RCC
->
AHBENR
 = 0x400080D8;

483 
FSMC_Bk1
->
BTCR
[4] = 0x00001011;

484 
FSMC_Bk1
->
BTCR
[5] = 0x00000300;

485 
FSMC_Bk1E
->
BWTR
[4] = 0x0FFFFFFF;

518 
	}
}

	@src/usb_desc.c

30 
	~"usb_lib.h
"

31 
	~"usb_desc.h
"

42 cڡ 
ut8_t
 
	gCuomHID_DeviDest
[
CUSTOMHID_SIZ_DEVICE_DESC
] =

45 
USB_DEVICE_DESCRIPTOR_TYPE
,

71 cڡ 
ut8_t
 
	gCuomHID_CfigDest
[
CUSTOMHID_SIZ_CONFIG_DESC
] =

74 
USB_CONFIGURATION_DESCRIPTOR_TYPE
,

75 
CUSTOMHID_SIZ_CONFIG_DESC
,

88 
USB_INTERFACE_DESCRIPTOR_TYPE
,

99 
HID_DESCRIPTOR_TYPE
,

105 
CUSTOMHID_SIZ_REPORT_DESC
,

110 
USB_ENDPOINT_DESCRIPTOR_TYPE
,

120 
USB_ENDPOINT_DESCRIPTOR_TYPE
,

131 cڡ 
ut8_t
 
	gCuomHID_RtDest
[
CUSTOMHID_SIZ_REPORT_DESC
] =

250 cڡ 
ut8_t
 
	gCuomHID_SgLgID
[
CUSTOMHID_SIZ_STRING_LANGID
] =

252 
CUSTOMHID_SIZ_STRING_LANGID
,

253 
USB_STRING_DESCRIPTOR_TYPE
,

259 cڡ 
ut8_t
 
	gCuomHID_SgVd
[
CUSTOMHID_SIZ_STRING_VENDOR
] =

261 
CUSTOMHID_SIZ_STRING_VENDOR
,

262 
USB_STRING_DESCRIPTOR_TYPE
,

269 cڡ 
ut8_t
 
	gCuomHID_SgProdu
[
CUSTOMHID_SIZ_STRING_PRODUCT
] =

271 
CUSTOMHID_SIZ_STRING_PRODUCT
,

272 
USB_STRING_DESCRIPTOR_TYPE
,

277 
ut8_t
 
	gCuomHID_SgSl
[
CUSTOMHID_SIZ_STRING_SERIAL
] =

279 
CUSTOMHID_SIZ_STRING_SERIAL
,

280 
USB_STRING_DESCRIPTOR_TYPE
,

	@src/usb_endp.c

31 
	~"hw_cfig.h
"

32 
	~"usb_lib.h
"

33 
	~"usb_ir.h
"

39 
ut8_t
 
	gReive_Bufr
[2];

40 
__IO
 
ut8_t
 
PvXrCome
;

50 
	$EP1_OUT_Clback
()

52 
BAi
 
Led_S
;

55 
	`USB_SIL_Rd
(
EP1_OUT
, 
Reive_Bufr
);

57 i(
Reive_Bufr
[1] == 0)

59 
Led_S
 = 
B_RESET
;

63 
Led_S
 = 
B_SET
;

67 
Reive_Bufr
[0])

70 i(
Led_S
 !
B_RESET
)

72 
	`STM_EVAL_LEDOn
(
LED1
);

76 
	`STM_EVAL_LEDOff
(
LED1
);

80 i(
Led_S
 !
B_RESET
)

82 
	`STM_EVAL_LEDOn
(
LED2
);

86 
	`STM_EVAL_LEDOff
(
LED2
);

90 i(
Led_S
 !
B_RESET
)

92 
	`STM_EVAL_LEDOn
(
LED3
);

96 
	`STM_EVAL_LEDOff
(
LED3
);

100 i(
Led_S
 !
B_RESET
)

102 
	`STM_EVAL_LEDOn
(
LED4
);

106 
	`STM_EVAL_LEDOff
(
LED4
);

110 
	`STM_EVAL_LEDOff
(
LED1
);

111 
	`STM_EVAL_LEDOff
(
LED2
);

112 
	`STM_EVAL_LEDOff
(
LED3
);

113 
	`STM_EVAL_LEDOff
(
LED4
);

117 
	`SEPRxStus
(
ENDP1
, 
EP_RX_VALID
);

119 
	}
}

128 
	$EP1_IN_Clback
()

130 
PvXrCome
 = 1;

131 
	}
}

	@src/usb_istr.c

30 
	~"usb_lib.h
"

31 
	~"usb_.h
"

32 
	~"usb_pwr.h
"

33 
	~"usb_ir.h
"

39 
__IO
 
ut16_t
 
	gwIr
;

40 
__IO
 
ut8_t
 
	gbIPackSOF
 = 0;

41 
__IO
 
ut32_t
 
	gesof_cou
 =0;

42 
__IO
 
ut32_t
 
	gwCNTR
=0;

48 (*
pEpI_IN
[7])() =

50 
EP1_IN_Clback
,

51 
EP2_IN_Clback
,

52 
EP3_IN_Clback
,

53 
EP4_IN_Clback
,

54 
EP5_IN_Clback
,

55 
EP6_IN_Clback
,

56 
EP7_IN_Clback
,

57 
	}
};

59 (*
pEpI_OUT
[7])() =

61 
EP1_OUT_Clback
,

62 
EP2_OUT_Clback
,

63 
EP3_OUT_Clback
,

64 
EP4_OUT_Clback
,

65 
EP5_OUT_Clback
,

66 
EP6_OUT_Clback
,

67 
EP7_OUT_Clback
,

68 
	}
};

77 
	$USB_Ir
()

79 
ut32_t
 
i
=0;

80 
__IO
 
ut32_t
 
EP
[8];

82 
wIr
 = 
	`_GISTR
();

84 #i(
IMR_MSK
 & 
ISTR_CTR
)

85 i(
wIr
 & 
ISTR_CTR
 & 
wIru_Mask
)

89 
	`CTR_LP
();

90 #ifde
CTR_CALLBACK


91 
	`CTR_Clback
();

96 #i(
IMR_MSK
 & 
ISTR_RESET
)

97 i(
wIr
 & 
ISTR_RESET
 & 
wIru_Mask
)

99 
	`_SISTR
((
ut16_t
)
CLR_RESET
);

100 
Devi_Prݔty
.
	`Ret
();

101 #ifde
RESET_CALLBACK


102 
	`RESET_Clback
();

107 #i(
IMR_MSK
 & 
ISTR_DOVR
)

108 i(
wIr
 & 
ISTR_DOVR
 & 
wIru_Mask
)

110 
	`_SISTR
((
ut16_t
)
CLR_DOVR
);

111 #ifde
DOVR_CALLBACK


112 
	`DOVR_Clback
();

117 #i(
IMR_MSK
 & 
ISTR_ERR
)

118 i(
wIr
 & 
ISTR_ERR
 & 
wIru_Mask
)

120 
	`_SISTR
((
ut16_t
)
CLR_ERR
);

121 #ifde
ERR_CALLBACK


122 
	`ERR_Clback
();

127 #i(
IMR_MSK
 & 
ISTR_WKUP
)

128 i(
wIr
 & 
ISTR_WKUP
 & 
wIru_Mask
)

130 
	`_SISTR
((
ut16_t
)
CLR_WKUP
);

131 
	`Resume
(
RESUME_EXTERNAL
);

132 #ifde
WKUP_CALLBACK


133 
	`WKUP_Clback
();

138 #i(
IMR_MSK
 & 
ISTR_SUSP
)

139 i(
wIr
 & 
ISTR_SUSP
 & 
wIru_Mask
)

143 i(
fSudEbd
)

145 
	`Sud
();

150 
	`Resume
(
RESUME_LATER
);

153 
	`_SISTR
((
ut16_t
)
CLR_SUSP
);

154 #ifde
SUSP_CALLBACK


155 
	`SUSP_Clback
();

160 #i(
IMR_MSK
 & 
ISTR_SOF
)

161 i(
wIr
 & 
ISTR_SOF
 & 
wIru_Mask
)

163 
	`_SISTR
((
ut16_t
)
CLR_SOF
);

164 
bIPackSOF
++;

166 #ifde
SOF_CALLBACK


167 
	`SOF_Clback
();

172 #i(
IMR_MSK
 & 
ISTR_ESOF
)

173 i(
wIr
 & 
ISTR_ESOF
 & 
wIru_Mask
)

176 
	`_SISTR
((
ut16_t
)
CLR_ESOF
);

178 i((
	`_GFNR
()&
FNR_RXDP
)!=0)

181 
esof_cou
 ++;

184 i((
esof_cou
 >3)&&((
	`_GCNTR
()&
CNTR_FSUSP
)==0))

189 
wCNTR
 = 
	`_GCNTR
();

192 
i
=0;i<8;i++
EP
[i] = 
	`_GENDPOINT
(i);

195 
wCNTR
|=
CNTR_FRES
;

196 
	`_SCNTR
(
wCNTR
);

199 
wCNTR
&=~
CNTR_FRES
;

200 
	`_SCNTR
(
wCNTR
);

203 (
	`_GISTR
()&
ISTR_RESET
) == 0);

206 
	`_SISTR
((
ut16_t
)
CLR_RESET
);

209 
i
=0;i<8;i++)

210 
	`_SENDPOINT
(
i
, 
EP
[i]);

212 
esof_cou
 = 0;

217 
esof_cou
 = 0;

221 
	`Resume
(
RESUME_ESOF
);

223 #ifde
ESOF_CALLBACK


224 
	`ESOF_Clback
();

228 
	}
}

	@src/usb_prop.c

31 
	~"hw_cfig.h
"

32 
	~"usb_lib.h
"

33 
	~"usb_cf.h
"

34 
	~"usb_.h
"

35 
	~"usb_desc.h
"

36 
	~"usb_pwr.h
"

43 
ut32_t
 
	gProcVue
;

44 
__IO
 
ut8_t
 
	gEXTI_Eb
;

45 
__IO
 
ut8_t
 
	gReque
 = 0;

46 
ut8_t
 
	gRt_Buf
[2];

51 
DEVICE
 
	gDevi_Tab
 =

53 
EP_NUM
,

57 
DEVICE_PROP
 
	gDevi_Prݔty
 =

59 
CuomHID_
,

60 
CuomHID_Ret
,

61 
CuomHID_Stus_In
,

62 
CuomHID_Stus_Out
,

63 
CuomHID_Da_Sup
,

64 
CuomHID_NoDa_Sup
,

65 
CuomHID_G_I_Stg
,

66 
CuomHID_GDeviDest
,

67 
CuomHID_GCfigDest
,

68 
CuomHID_GSgDest
,

72 
USER_STANDARD_REQUESTS
 
	gUr_Sndd_Reques
 =

74 
CuomHID_GCfiguti
,

75 
CuomHID_SCfiguti
,

76 
CuomHID_GI
,

77 
CuomHID_SI
,

78 
CuomHID_GStus
,

79 
CuomHID_CˬFtu
,

80 
CuomHID_SEndPotFtu
,

81 
CuomHID_SDeviFtu
,

82 
CuomHID_SDeviAddss


85 
ONE_DESCRIPTOR
 
	gDevi_Dest
 =

87 (
ut8_t
*)
CuomHID_DeviDest
,

88 
CUSTOMHID_SIZ_DEVICE_DESC


91 
ONE_DESCRIPTOR
 
	gCfig_Dest
 =

93 (
ut8_t
*)
CuomHID_CfigDest
,

94 
CUSTOMHID_SIZ_CONFIG_DESC


97 
ONE_DESCRIPTOR
 
	gCuomHID_Rt_Dest
 =

99 (
ut8_t
 *)
CuomHID_RtDest
,

100 
CUSTOMHID_SIZ_REPORT_DESC


103 
ONE_DESCRIPTOR
 
	gCuomHID_Hid_Dest
 =

105 (
ut8_t
*)
CuomHID_CfigDest
 + 
CUSTOMHID_OFF_HID_DESC
,

106 
CUSTOMHID_SIZ_HID_DESC


109 
ONE_DESCRIPTOR
 
	gSg_Dest
[4] =

111 {(
ut8_t
*)
CuomHID_SgLgID
, 
CUSTOMHID_SIZ_STRING_LANGID
},

112 {(
ut8_t
*)
CuomHID_SgVd
, 
CUSTOMHID_SIZ_STRING_VENDOR
},

113 {(
ut8_t
*)
CuomHID_SgProdu
, 
CUSTOMHID_SIZ_STRING_PRODUCT
},

114 {(
ut8_t
*)
CuomHID_SgSl
, 
CUSTOMHID_SIZ_STRING_SERIAL
}

121 
ut8_t
 *
CuomHID_SRt_Ftu
(
ut16_t
 
Lgth
);

133 
	$CuomHID_
()

137 
	`G_SlNum
();

139 
pInfmi
->
Cut_Cfiguti
 = 0;

141 
	`PowOn
();

144 
	`USB_SIL_In
();

146 
bDeviS
 = 
UNCONNECTED
;

147 
	}
}

156 
	$CuomHID_Ret
()

159 
pInfmi
->
Cut_Cfiguti
 = 0;

160 
pInfmi
->
Cut_I
 = 0;

163 
pInfmi
->
Cut_Ftu
 = 
CuomHID_CfigDest
[7];

165 
	`SBTABLE
(
BTABLE_ADDRESS
);

168 
	`SEPTy
(
ENDP0
, 
EP_CONTROL
);

169 
	`SEPTxStus
(
ENDP0
, 
EP_TX_STALL
);

170 
	`SEPRxAddr
(
ENDP0
, 
ENDP0_RXADDR
);

171 
	`SEPTxAddr
(
ENDP0
, 
ENDP0_TXADDR
);

172 
	`Cˬ_Stus_Out
(
ENDP0
);

173 
	`SEPRxCou
(
ENDP0
, 
Devi_Prݔty
.
MaxPackSize
);

174 
	`SEPRxVid
(
ENDP0
);

177 
	`SEPTy
(
ENDP1
, 
EP_INTERRUPT
);

178 
	`SEPTxAddr
(
ENDP1
, 
ENDP1_TXADDR
);

179 
	`SEPRxAddr
(
ENDP1
, 
ENDP1_RXADDR
);

180 
	`SEPTxCou
(
ENDP1
, 2);

181 
	`SEPRxCou
(
ENDP1
, 2);

182 
	`SEPRxStus
(
ENDP1
, 
EP_RX_VALID
);

183 
	`SEPTxStus
(
ENDP1
, 
EP_TX_NAK
);

186 
	`SDeviAddss
(0);

187 
bDeviS
 = 
ATTACHED
;

188 
	}
}

197 
	$CuomHID_SCfiguti
()

199 i(
pInfmi
->
Cut_Cfiguti
 != 0)

202 
bDeviS
 = 
CONFIGURED
;

205 #i
	`defed
(
STM32L1XX_MD
|| defed(
STM32L1XX_HD
)|| defed(
STM32L1XX_MD_PLUS
)|| defed(
STM32F37X
)

206 
	`ADC_SoweSCv
(
ADC1
);

207 #i
	`defed
 (
STM32F30X
)

208 
	`ADC_SCvsi
(
ADC1
);

210 
	`ADC_SoweSCvCmd
(
ADC1
, 
ENABLE
);

213 
	}
}

221 
	$CuomHID_SDeviAddss
 ()

223 
bDeviS
 = 
ADDRESSED
;

224 
	}
}

232 
	$CuomHID_Stus_In
()

234 
BAi
 
Led_S
;

236 i(
Rt_Buf
[1] == 0)

238 
Led_S
 = 
B_RESET
;

242 
Led_S
 = 
B_SET
;

245 
Rt_Buf
[0])

250 i(
Led_S
 !
B_RESET
)

252 
	`STM_EVAL_LEDOn
(
LED1
);

256 
	`STM_EVAL_LEDOff
(
LED1
);

260 i(
Led_S
 !
B_RESET
)

262 
	`STM_EVAL_LEDOn
(
LED2
);

266 
	`STM_EVAL_LEDOff
(
LED2
);

270 i(
Led_S
 !
B_RESET
)

272 
	`STM_EVAL_LEDOn
(
LED3
);

276 
	`STM_EVAL_LEDOff
(
LED3
);

280 i(
Led_S
 !
B_RESET
)

282 
	`STM_EVAL_LEDOn
(
LED4
);

286 
	`STM_EVAL_LEDOff
(
LED4
);

290 
	`STM_EVAL_LEDOff
(
LED1
);

291 
	`STM_EVAL_LEDOff
(
LED2
);

292 
	`STM_EVAL_LEDOff
(
LED3
);

293 
	`STM_EVAL_LEDOff
(
LED4
);

296 
	}
}

305 
	$CuomHID_Stus_Out
 ()

307 
	}
}

316 
RESULT
 
	$CuomHID_Da_Sup
(
ut8_t
 
RequeNo
)

318 
ut8_t
 *(*
CyRoute
)(
ut16_t
);

320 i(
pInfmi
->
USBwIndex
 != 0)

321  
USB_UNSUPPORT
;

323 
CyRoute
 = 
NULL
;

325 i((
RequeNo
 =
GET_DESCRIPTOR
)

326 && (
Ty_Rec
 =(
STANDARD_REQUEST
 | 
INTERFACE_RECIPIENT
))

330 i(
pInfmi
->
USBwVue1
 =
REPORT_DESCRIPTOR
)

332 
CyRoute
 = 
CuomHID_GRtDest
;

334 i(
pInfmi
->
USBwVue1
 =
HID_DESCRIPTOR_TYPE
)

336 
CyRoute
 = 
CuomHID_GHIDDest
;

342 i(
Ty_Rec
 =(
CLASS_REQUEST
 | 
INTERFACE_RECIPIENT
)) )

344  
RequeNo
 )

346 
GET_PROTOCOL
:

347 
CyRoute
 = 
CuomHID_GProcVue
;

349 
SET_REPORT
:

350 
CyRoute
 = 
CuomHID_SRt_Ftu
;

351 
Reque
 = 
SET_REPORT
;

358 i(
CyRoute
 =
NULL
)

360  
USB_UNSUPPORT
;

363 
pInfmi
->
Cl_Info
.
CyDa
 = 
CyRoute
;

364 
pInfmi
->
Cl_Info
.
Usb_wOfft
 = 0;

365 (*
CyRoute
)(0);

366  
USB_SUCCESS
;

367 
	}
}

376 
ut8_t
 *
	$CuomHID_SRt_Ftu
(
ut16_t
 
Lgth
)

378 i(
Lgth
 == 0)

380 
pInfmi
->
Cl_Info
.
Usb_wLgth
 = 2;

381  
NULL
;

385  
Rt_Buf
;

387 
	}
}

396 
RESULT
 
	$CuomHID_NoDa_Sup
(
ut8_t
 
RequeNo
)

398 i((
Ty_Rec
 =(
CLASS_REQUEST
 | 
INTERFACE_RECIPIENT
))

399 && (
RequeNo
 =
SET_PROTOCOL
))

401  
	`CuomHID_SProc
();

406  
USB_UNSUPPORT
;

408 
	}
}

417 
ut8_t
 *
	$CuomHID_GDeviDest
(
ut16_t
 
Lgth
)

419  
	`Sndd_GDestDa
(
Lgth
, &
Devi_Dest
);

420 
	}
}

429 
ut8_t
 *
	$CuomHID_GCfigDest
(
ut16_t
 
Lgth
)

431  
	`Sndd_GDestDa
(
Lgth
, &
Cfig_Dest
);

432 
	}
}

441 
ut8_t
 *
	$CuomHID_GSgDest
(
ut16_t
 
Lgth
)

443 
ut8_t
 
wVue0
 = 
pInfmi
->
USBwVue0
;

444 i(
wVue0
 > 4)

446  
NULL
;

450  
	`Sndd_GDestDa
(
Lgth
, &
Sg_Dest
[
wVue0
]);

452 
	}
}

461 
ut8_t
 *
	$CuomHID_GRtDest
(
ut16_t
 
Lgth
)

463  
	`Sndd_GDestDa
(
Lgth
, &
CuomHID_Rt_Dest
);

464 
	}
}

473 
ut8_t
 *
	$CuomHID_GHIDDest
(
ut16_t
 
Lgth
)

475  
	`Sndd_GDestDa
(
Lgth
, &
CuomHID_Hid_Dest
);

476 
	}
}

487 
RESULT
 
	$CuomHID_G_I_Stg
(
ut8_t
 
I
, ut8_
AɔǋStg
)

489 i(
AɔǋStg
 > 0)

491  
USB_UNSUPPORT
;

493 i(
I
 > 0)

495  
USB_UNSUPPORT
;

497  
USB_SUCCESS
;

498 
	}
}

507 
RESULT
 
	$CuomHID_SProc
()

509 
ut8_t
 
wVue0
 = 
pInfmi
->
USBwVue0
;

510 
ProcVue
 = 
wVue0
;

511  
USB_SUCCESS
;

512 
	}
}

521 
ut8_t
 *
	$CuomHID_GProcVue
(
ut16_t
 
Lgth
)

523 i(
Lgth
 == 0)

525 
pInfmi
->
Cl_Info
.
Usb_wLgth
 = 1;

526  
NULL
;

530  (
ut8_t
 *)(&
ProcVue
);

532 
	}
}

	@src/usb_pwr.c

30 
	~"usb_lib.h
"

31 
	~"usb_cf.h
"

32 
	~"usb_pwr.h
"

33 
	~"hw_cfig.h
"

39 
__IO
 
ut32_t
 
	gbDeviS
 = 
UNCONNECTED
;

40 
__IO
 
bo
 
	gfSudEbd
 = 
TRUE
;

41 
__IO
 
ut32_t
 
	gEP
[8];

45 
__IO
 
RESUME_STATE
 
	meS
;

46 
__IO
 
ut8_t
 
	mbESOFt
;

48 
	gResumeS
;

50 
__IO
 
ut32_t
 
	gmewakeup
=0;

64 
RESULT
 
	$PowOn
()

66 
ut16_t
 
wRegV
;

69 
	`USB_Cab_Cfig
(
ENABLE
);

72 
wRegV
 = 
CNTR_FRES
;

73 
	`_SCNTR
(
wRegV
);

76 
wIru_Mask
 = 0;

77 
	`_SCNTR
(
wIru_Mask
);

79 
	`_SISTR
(0);

81 
wIru_Mask
 = 
CNTR_RESETM
 | 
CNTR_SUSPM
 | 
CNTR_WKUPM
;

82 
	`_SCNTR
(
wIru_Mask
);

84  
USB_SUCCESS
;

85 
	}
}

94 
RESULT
 
	$PowOff
()

97 
	`_SCNTR
(
CNTR_FRES
);

99 
	`_SISTR
(0);

101 
	`USB_Cab_Cfig
(
DISABLE
);

103 
	`_SCNTR
(
CNTR_FRES
 + 
CNTR_PDWN
);

107  
USB_SUCCESS
;

108 
	}
}

117 
	$Sud
()

119 
ut32_t
 
i
 =0;

120 
ut16_t
 
wCNTR
;

121 
ut32_t
 
tmeg
 = 0;

122 
__IO
 
ut32_t
 
vePWR_CR
=0;

127 
wCNTR
 = 
	`_GCNTR
();

132 
i
=0;i<8;i++
EP
[i] = 
	`_GENDPOINT
(i);

135 
wCNTR
|=
CNTR_RESETM
;

136 
	`_SCNTR
(
wCNTR
);

139 
wCNTR
|=
CNTR_FRES
;

140 
	`_SCNTR
(
wCNTR
);

143 
wCNTR
&=~
CNTR_FRES
;

144 
	`_SCNTR
(
wCNTR
);

147 (
	`_GISTR
()&
ISTR_RESET
) == 0);

150 
	`_SISTR
((
ut16_t
)
CLR_RESET
);

153 
i
=0;i<8;i++)

154 
	`_SENDPOINT
(
i
, 
EP
[i]);

157 
wCNTR
 |
CNTR_FSUSP
;

158 
	`_SCNTR
(
wCNTR
);

161 
wCNTR
 = 
	`_GCNTR
();

162 
wCNTR
 |
CNTR_LPMODE
;

163 
	`_SCNTR
(
wCNTR
);

167 
vePWR_CR
 = 
PWR
->
CR
;

168 
tmeg
 = 
PWR
->
CR
;

170 
tmeg
 &((
ut32_t
)0xFFFFFFFC);

172 
tmeg
 |
PWR_Regut_LowPow
;

174 
PWR
->
CR
 = 
tmeg
;

176 #i
	`defed
 (
STM32F30X
|| defed (
STM32F37X
)

177 
SCB
->
SCR
 |
SCB_SCR_SLEEPDEEP_Msk
;

179 
SCB
->
SCR
 |
SCB_SCR_SLEEPDEEP
;

183 if((
	`_GISTR
()&
ISTR_WKUP
)==0)

185 
	`__WFI
();

187 #i
	`defed
 (
STM32F30X
|| defed (
STM32F37X
)

188 
SCB
->
SCR
 &(
ut32_t
)~((ut32_t)
SCB_SCR_SLEEPDEEP_Msk
);

190 
SCB
->
SCR
 &(
ut32_t
)~((ut32_t)
SCB_SCR_SLEEPDEEP
);

196 
	`_SISTR
(
CLR_WKUP
);

198 
wCNTR
 = 
	`_GCNTR
();

199 
wCNTR
&=~
CNTR_FSUSP
;

200 
	`_SCNTR
(
wCNTR
);

204 
PWR
->
CR
 = 
vePWR_CR
;

207 #i
	`defed
 (
STM32F30X
|| defed (
STM32F37X
)

208 
SCB
->
SCR
 &(
ut32_t
)~((ut32_t)
SCB_SCR_SLEEPDEEP_Msk
);

210 
SCB
->
SCR
 &(
ut32_t
)~((ut32_t)
SCB_SCR_SLEEPDEEP
);

213 
	}
}

222 
	$Resume_In
()

224 
ut16_t
 
wCNTR
;

231 
wCNTR
 = 
	`_GCNTR
();

232 
wCNTR
 &(~
CNTR_LPMODE
);

233 
	`_SCNTR
(
wCNTR
);

237 
	`Lve_LowPowMode
();

240 
	`_SCNTR
(
IMR_MSK
);

245 
	}
}

259 
	$Resume
(
RESUME_STATE
 
eResumeSV
)

261 
ut16_t
 
wCNTR
;

263 i(
eResumeSV
 !
RESUME_ESOF
)

264 
ResumeS
.
eS
 = 
eResumeSV
;

265 
ResumeS
.
eS
)

267 
RESUME_EXTERNAL
:

268 i(
mewakeup
 ==0)

270 
	`Resume_In
();

271 
ResumeS
.
eS
 = 
RESUME_OFF
;

275 
ResumeS
.
eS
 = 
RESUME_ON
;

278 
RESUME_INTERNAL
:

279 
	`Resume_In
();

280 
ResumeS
.
eS
 = 
RESUME_START
;

281 
mewakeup
 = 1;

283 
RESUME_LATER
:

284 
ResumeS
.
bESOFt
 = 2;

285 
ResumeS
.
eS
 = 
RESUME_WAIT
;

287 
RESUME_WAIT
:

288 
ResumeS
.
bESOFt
--;

289 i(
ResumeS
.
bESOFt
 == 0)

290 
ResumeS
.
eS
 = 
RESUME_START
;

292 
RESUME_START
:

293 
wCNTR
 = 
	`_GCNTR
();

294 
wCNTR
 |
CNTR_RESUME
;

295 
	`_SCNTR
(
wCNTR
);

296 
ResumeS
.
eS
 = 
RESUME_ON
;

297 
ResumeS
.
bESOFt
 = 10;

299 
RESUME_ON
:

300 
ResumeS
.
bESOFt
--;

301 i(
ResumeS
.
bESOFt
 == 0)

303 
wCNTR
 = 
	`_GCNTR
();

304 
wCNTR
 &(~
CNTR_RESUME
);

305 
	`_SCNTR
(
wCNTR
);

306 
ResumeS
.
eS
 = 
RESUME_OFF
;

307 
mewakeup
 = 0;

310 
RESUME_OFF
:

311 
RESUME_ESOF
:

313 
ResumeS
.
eS
 = 
RESUME_OFF
;

316 
	}
}

	@
1
.
0
24
419
inc/hw_config.h
inc/platform_config.h
inc/stm32_it.h
inc/stm32f10x_conf.h
inc/stm32f30x_conf.h
inc/stm32f37x_conf.h
inc/stm32l1xx_conf.h
inc/usb_conf.h
inc/usb_desc.h
inc/usb_istr.h
inc/usb_prop.h
inc/usb_pwr.h
src/hw_config.c
src/main.c
src/stm32_it.c
src/system_stm32f10x.c
src/system_stm32f30x.c
src/system_stm32f37x.c
src/system_stm32l1xx.c
src/usb_desc.c
src/usb_endp.c
src/usb_istr.c
src/usb_prop.c
src/usb_pwr.c
